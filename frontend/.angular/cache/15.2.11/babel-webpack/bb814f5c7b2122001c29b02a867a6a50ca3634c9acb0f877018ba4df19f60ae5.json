{"ast":null,"code":"import { first } from 'rxjs/operators';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/router\";\nimport * as i2 from \"@app/_services\";\nimport * as i3 from \"@angular/common\";\nfunction RequestListComponent_ng_container_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" for Employee \", ctx_r0.displayEmployeeId, \" \");\n  }\n}\nfunction RequestListComponent_div_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 7);\n    i0.ɵɵelement(1, \"span\", 8);\n    i0.ɵɵtext(2, \" Loading requests... \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction RequestListComponent_div_6_tr_15_span_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\");\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const request_r5 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate2(\" \", request_r5.Employee.User.email, \" (\", request_r5.Employee.User.role === \"Admin\" ? \"Admin User\" : \"Normal User\", \") \");\n  }\n}\nfunction RequestListComponent_div_6_tr_15_span_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\");\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const request_r5 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate2(\" \", request_r5.userEmail, \" (\", request_r5.userRole === \"Admin\" ? \"Admin User\" : \"Normal User\", \") \");\n  }\n}\nfunction RequestListComponent_div_6_tr_15_span_6_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\");\n    i0.ɵɵtext(1, \" Unknown \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction RequestListComponent_div_6_tr_15_ul_8_ng_container_1_li_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"li\");\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const item_r16 = ctx.$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate2(\" \", item_r16.name, \" (x\", item_r16.quantity, \") \");\n  }\n}\nfunction RequestListComponent_div_6_tr_15_ul_8_ng_container_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵtemplate(1, RequestListComponent_div_6_tr_15_ul_8_ng_container_1_li_1_Template, 2, 2, \"li\", 11);\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    const request_r5 = i0.ɵɵnextContext(2).$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", request_r5.items);\n  }\n}\nfunction RequestListComponent_div_6_tr_15_ul_8_ng_container_2_li_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"li\");\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const item_r19 = ctx.$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate2(\" \", item_r19.name, \" (x\", item_r19.quantity, \") \");\n  }\n}\nfunction RequestListComponent_div_6_tr_15_ul_8_ng_container_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵtemplate(1, RequestListComponent_div_6_tr_15_ul_8_ng_container_2_li_1_Template, 2, 2, \"li\", 11);\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    const request_r5 = i0.ɵɵnextContext(2).$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", request_r5.requestItems);\n  }\n}\nfunction RequestListComponent_div_6_tr_15_ul_8_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"ul\", 15);\n    i0.ɵɵtemplate(1, RequestListComponent_div_6_tr_15_ul_8_ng_container_1_Template, 2, 1, \"ng-container\", 2);\n    i0.ɵɵtemplate(2, RequestListComponent_div_6_tr_15_ul_8_ng_container_2_Template, 2, 1, \"ng-container\", 2);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const request_r5 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", request_r5.items && request_r5.items.length > 0);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", !request_r5.items && request_r5.requestItems && request_r5.requestItems.length > 0);\n  }\n}\nfunction RequestListComponent_div_6_tr_15_span_9_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\");\n    i0.ɵɵtext(1, \"No items\");\n    i0.ɵɵelementEnd();\n  }\n}\nconst _c0 = function (a0, a1, a2) {\n  return {\n    \"bg-warning text-dark\": a0,\n    \"bg-success\": a1,\n    \"bg-danger\": a2\n  };\n};\nconst _c1 = function (a1) {\n  return [\"edit\", a1];\n};\nfunction RequestListComponent_div_6_tr_15_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\");\n    i0.ɵɵtemplate(4, RequestListComponent_div_6_tr_15_span_4_Template, 2, 2, \"span\", 2);\n    i0.ɵɵtemplate(5, RequestListComponent_div_6_tr_15_span_5_Template, 2, 2, \"span\", 2);\n    i0.ɵɵtemplate(6, RequestListComponent_div_6_tr_15_span_6_Template, 2, 0, \"span\", 2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"td\");\n    i0.ɵɵtemplate(8, RequestListComponent_div_6_tr_15_ul_8_Template, 3, 2, \"ul\", 12);\n    i0.ɵɵtemplate(9, RequestListComponent_div_6_tr_15_span_9_Template, 2, 0, \"span\", 2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(10, \"td\")(11, \"span\", 13);\n    i0.ɵɵtext(12);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(13, \"td\")(14, \"button\", 14);\n    i0.ɵɵtext(15, \"Edit\");\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const request_r5 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(request_r5.type);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", request_r5.Employee == null ? null : request_r5.Employee.User == null ? null : request_r5.Employee.User.email);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", !(request_r5.Employee == null ? null : request_r5.Employee.User == null ? null : request_r5.Employee.User.email) && request_r5.userEmail);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", !(request_r5.Employee == null ? null : request_r5.Employee.User == null ? null : request_r5.Employee.User.email) && !request_r5.userEmail);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", request_r5.items && request_r5.items.length > 0 || request_r5.requestItems && request_r5.requestItems.length > 0);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", (!request_r5.items || request_r5.items.length === 0) && (!request_r5.requestItems || request_r5.requestItems.length === 0));\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction3(9, _c0, request_r5.status === \"Pending\", request_r5.status === \"Approved\" || request_r5.status === \"Approve\", request_r5.status === \"Rejected\" || request_r5.status === \"Reject\"));\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", request_r5.status, \" \");\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"routerLink\", i0.ɵɵpureFunction1(13, _c1, request_r5.id));\n  }\n}\nfunction RequestListComponent_div_6_tr_16_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\", 16);\n    i0.ɵɵtext(2, \"No requests found\");\n    i0.ɵɵelementEnd()();\n  }\n}\nfunction RequestListComponent_div_6_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 9)(1, \"table\", 10)(2, \"thead\")(3, \"tr\")(4, \"th\");\n    i0.ɵɵtext(5, \"Type\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"th\");\n    i0.ɵɵtext(7, \"Employee\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"th\");\n    i0.ɵɵtext(9, \"Items\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(10, \"th\");\n    i0.ɵɵtext(11, \"Status\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(12, \"th\");\n    i0.ɵɵtext(13, \"Actions\");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(14, \"tbody\");\n    i0.ɵɵtemplate(15, RequestListComponent_div_6_tr_15_Template, 16, 15, \"tr\", 11);\n    i0.ɵɵtemplate(16, RequestListComponent_div_6_tr_16_Template, 3, 0, \"tr\", 2);\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(15);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r2.requests);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r2.requests.length === 0);\n  }\n}\nexport let RequestListComponent = /*#__PURE__*/(() => {\n  class RequestListComponent {\n    constructor(router, route, accountService, employeeService, requestService, alertService) {\n      this.router = router;\n      this.route = route;\n      this.accountService = accountService;\n      this.employeeService = employeeService;\n      this.requestService = requestService;\n      this.alertService = alertService;\n      this.requests = [];\n      this.account = this.accountService.accountValue;\n      this.employeeId = null;\n      this.displayEmployeeId = null;\n      this.loading = false;\n    }\n    ngOnInit() {\n      // Get the employeeId from the route query parameters\n      this.route.queryParams.subscribe(params => {\n        this.employeeId = params['employeeId'];\n        if (this.employeeId) {\n          // If we have an employeeId, get the employee details to show in the header\n          this.employeeService.getById(this.employeeId).pipe(first()).subscribe({\n            next: employee => {\n              this.displayEmployeeId = employee.employeeId;\n              // Load requests filtered by this employee\n              this.loadRequestsByEmployeeId(this.employeeId);\n            },\n            error: error => {\n              console.error('Error loading employee details:', error);\n              this.alertService.error('Failed to load employee details');\n            }\n          });\n        } else {\n          // Otherwise load all requests\n          this.loadAllRequests();\n        }\n      });\n    }\n    loadAllRequests() {\n      this.loading = true;\n      this.requestService.getAll().pipe(first()).subscribe({\n        next: requests => {\n          console.log('Loaded requests:', requests);\n          // Debug: Print the data structure of the first request to see what's available\n          if (requests.length > 0) {\n            console.log('First request structure:', {\n              id: requests[0].id,\n              type: requests[0].type,\n              employeeId: requests[0].employeeId,\n              hasItems: !!requests[0].items,\n              items: requests[0].items,\n              hasRequestItems: !!requests[0].requestItems,\n              requestItems: requests[0].requestItems,\n              // Log raw structure to see everything\n              rawObject: JSON.stringify(requests[0])\n            });\n          }\n          this.requests = requests;\n          this.loading = false;\n        },\n        error: error => {\n          console.error('Error loading requests:', error);\n          this.alertService.error('Failed to load requests');\n          this.loading = false;\n        }\n      });\n    }\n    loadRequestsByEmployeeId(employeeId) {\n      // Get requests filtered by employee ID\n      this.loading = true;\n      this.requestService.getAll().pipe(first()).subscribe({\n        next: requests => {\n          // Filter requests to only show those for this employee\n          this.requests = requests.filter(r => {\n            var _a;\n            return ((_a = r.employeeId) === null || _a === void 0 ? void 0 : _a.toString()) === (employeeId === null || employeeId === void 0 ? void 0 : employeeId.toString());\n          });\n          console.log(`Loaded ${this.requests.length} requests for employee ID ${employeeId}`);\n          // Debug: Print the data structure if requests were found\n          if (this.requests.length > 0) {\n            console.log('First filtered request structure:', {\n              id: this.requests[0].id,\n              type: this.requests[0].type,\n              employeeId: this.requests[0].employeeId,\n              hasItems: !!this.requests[0].items,\n              items: this.requests[0].items,\n              hasRequestItems: !!this.requests[0].requestItems,\n              requestItems: this.requests[0].requestItems,\n              // Log raw structure to see everything\n              rawObject: JSON.stringify(this.requests[0])\n            });\n          }\n          this.loading = false;\n        },\n        error: error => {\n          console.error('Error loading requests:', error);\n          this.alertService.error('Failed to load requests');\n          this.loading = false;\n        }\n      });\n    }\n    add() {\n      const route = ['add'];\n      if (this.employeeId) {\n        this.router.navigate(route, {\n          relativeTo: this.route,\n          queryParams: {\n            employeeId: this.employeeId\n          }\n        });\n      } else {\n        this.router.navigate(route, {\n          relativeTo: this.route\n        });\n      }\n    }\n    edit(id) {\n      const route = ['edit', id];\n      if (this.employeeId) {\n        this.router.navigate(route, {\n          relativeTo: this.route,\n          queryParams: {\n            employeeId: this.employeeId\n          }\n        });\n      } else {\n        this.router.navigate(route, {\n          relativeTo: this.route\n        });\n      }\n    }\n    delete(id) {\n      if (confirm('Are you sure you want to delete this request?')) {\n        this.requestService.delete(id).pipe(first()).subscribe({\n          next: () => {\n            this.requests = this.requests.filter(x => x.id !== id);\n            this.alertService.success('Request deleted successfully');\n          },\n          error: error => {\n            console.error('Error deleting request:', error);\n            this.alertService.error('Failed to delete request');\n          }\n        });\n      }\n    }\n  }\n  RequestListComponent.ɵfac = function RequestListComponent_Factory(t) {\n    return new (t || RequestListComponent)(i0.ɵɵdirectiveInject(i1.Router), i0.ɵɵdirectiveInject(i1.ActivatedRoute), i0.ɵɵdirectiveInject(i2.AccountService), i0.ɵɵdirectiveInject(i2.EmployeeService), i0.ɵɵdirectiveInject(i2.RequestService), i0.ɵɵdirectiveInject(i2.AlertService));\n  };\n  RequestListComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: RequestListComponent,\n    selectors: [[\"ng-component\"]],\n    decls: 9,\n    vars: 3,\n    consts: [[1, \"card\"], [1, \"card-header\"], [4, \"ngIf\"], [1, \"card-body\"], [\"class\", \"text-center p-3\", 4, \"ngIf\"], [\"class\", \"table-responsive\", 4, \"ngIf\"], [1, \"btn\", \"btn-primary\", \"float-end\", 3, \"click\"], [1, \"text-center\", \"p-3\"], [1, \"spinner-border\", \"spinner-border-sm\", \"me-1\"], [1, \"table-responsive\"], [1, \"table\", \"table-striped\"], [4, \"ngFor\", \"ngForOf\"], [\"class\", \"list-unstyled mb-0\", 4, \"ngIf\"], [1, \"badge\", 3, \"ngClass\"], [1, \"btn\", \"btn-sm\", \"btn-primary\", \"me-1\", 3, \"routerLink\"], [1, \"list-unstyled\", \"mb-0\"], [\"colspan\", \"5\", 1, \"text-center\"]],\n    template: function RequestListComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1);\n        i0.ɵɵtext(2, \" Requests \");\n        i0.ɵɵtemplate(3, RequestListComponent_ng_container_3_Template, 2, 1, \"ng-container\", 2);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(4, \"div\", 3);\n        i0.ɵɵtemplate(5, RequestListComponent_div_5_Template, 3, 0, \"div\", 4);\n        i0.ɵɵtemplate(6, RequestListComponent_div_6_Template, 17, 2, \"div\", 5);\n        i0.ɵɵelementStart(7, \"button\", 6);\n        i0.ɵɵlistener(\"click\", function RequestListComponent_Template_button_click_7_listener() {\n          return ctx.add();\n        });\n        i0.ɵɵtext(8, \"Add Request\");\n        i0.ɵɵelementEnd()()();\n      }\n      if (rf & 2) {\n        i0.ɵɵadvance(3);\n        i0.ɵɵproperty(\"ngIf\", ctx.employeeId && ctx.displayEmployeeId);\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngIf\", ctx.loading);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", !ctx.loading);\n      }\n    },\n    dependencies: [i3.NgClass, i3.NgForOf, i3.NgIf, i1.RouterLink],\n    encapsulation: 2\n  });\n  return RequestListComponent;\n})();","map":{"version":3,"mappings":"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","names":["first","i0","RequestListComponent","constructor","router","route","accountService","employeeService","requestService","alertService","accountValue","ngOnInit","queryParams","subscribe","params","employeeId","getById","pipe","next","employee","displayEmployeeId","loadRequestsByEmployeeId","error","console","loadAllRequests","loading","getAll","requests","log","length","id","type","hasItems","items","hasRequestItems","requestItems","rawObject","JSON","stringify","filter","r","toString","add","navigate","relativeTo","edit","delete","confirm","x","success","selectors","decls","vars","consts","template","ctx"],"sourceRoot":"","sources":["C:\\xampp\\htdocs\\groupB-fullstack-app\\frontend\\src\\app\\requests\\list.component.ts","C:\\xampp\\htdocs\\groupB-fullstack-app\\frontend\\src\\app\\requests\\list.component.html"],"sourcesContent":["import { Component, OnInit } from '@angular/core';\nimport { Router, ActivatedRoute } from '@angular/router';\nimport { AccountService, EmployeeService, RequestService, AlertService } from '@app/_services';\nimport { first } from 'rxjs/operators';\n\n@Component({\n  templateUrl: 'list.component.html'\n})\nexport class RequestListComponent implements OnInit {\n  requests: any[] = [];\n  account = this.accountService.accountValue;\n  employeeId: string | null = null;\n  displayEmployeeId: string | null = null;\n  loading = false;\n\n  constructor(\n    private router: Router,\n    private route: ActivatedRoute,\n    private accountService: AccountService,\n    private employeeService: EmployeeService,\n    private requestService: RequestService,\n    private alertService: AlertService\n  ) { }\n\n  ngOnInit() {\n    // Get the employeeId from the route query parameters\n    this.route.queryParams.subscribe(params => {\n      this.employeeId = params['employeeId'];\n      \n      if (this.employeeId) {\n        // If we have an employeeId, get the employee details to show in the header\n        this.employeeService.getById(this.employeeId)\n          .pipe(first())\n          .subscribe({\n            next: employee => {\n              this.displayEmployeeId = employee.employeeId;\n              // Load requests filtered by this employee\n              this.loadRequestsByEmployeeId(this.employeeId);\n            },\n            error: error => {\n              console.error('Error loading employee details:', error);\n              this.alertService.error('Failed to load employee details');\n            }\n          });\n      } else {\n        // Otherwise load all requests\n        this.loadAllRequests();\n      }\n    });\n  }\n\n  private loadAllRequests() {\n    this.loading = true;\n    this.requestService.getAll()\n      .pipe(first())\n      .subscribe({\n        next: (requests: any[]) => {\n          console.log('Loaded requests:', requests);\n          \n          // Debug: Print the data structure of the first request to see what's available\n          if (requests.length > 0) {\n            console.log('First request structure:', {\n              id: requests[0].id,\n              type: requests[0].type,\n              employeeId: requests[0].employeeId,\n              hasItems: !!requests[0].items,\n              items: requests[0].items,\n              hasRequestItems: !!requests[0].requestItems,\n              requestItems: requests[0].requestItems,\n              // Log raw structure to see everything\n              rawObject: JSON.stringify(requests[0])\n            });\n          }\n          \n          this.requests = requests;\n          this.loading = false;\n        },\n        error: error => {\n          console.error('Error loading requests:', error);\n          this.alertService.error('Failed to load requests');\n          this.loading = false;\n        }\n      });\n  }\n\n  private loadRequestsByEmployeeId(employeeId: string) {\n    // Get requests filtered by employee ID\n    this.loading = true;\n    this.requestService.getAll()\n      .pipe(first())\n      .subscribe({\n        next: (requests: any[]) => {\n          // Filter requests to only show those for this employee\n          this.requests = requests.filter(r => r.employeeId?.toString() === employeeId?.toString());\n          console.log(`Loaded ${this.requests.length} requests for employee ID ${employeeId}`);\n          \n          // Debug: Print the data structure if requests were found\n          if (this.requests.length > 0) {\n            console.log('First filtered request structure:', {\n              id: this.requests[0].id,\n              type: this.requests[0].type,\n              employeeId: this.requests[0].employeeId,\n              hasItems: !!this.requests[0].items,\n              items: this.requests[0].items,\n              hasRequestItems: !!this.requests[0].requestItems,\n              requestItems: this.requests[0].requestItems,\n              // Log raw structure to see everything\n              rawObject: JSON.stringify(this.requests[0])\n            });\n          }\n          \n          this.loading = false;\n        },\n        error: error => {\n          console.error('Error loading requests:', error);\n          this.alertService.error('Failed to load requests');\n          this.loading = false;\n        }\n      });\n  }\n\n  add() {\n    const route = ['add'];\n    if (this.employeeId) {\n      this.router.navigate(route, { \n        relativeTo: this.route,\n        queryParams: { employeeId: this.employeeId } \n      });\n    } else {\n      this.router.navigate(route, { relativeTo: this.route });\n    }\n  }\n\n  edit(id: string) {\n    const route = ['edit', id];\n    if (this.employeeId) {\n      this.router.navigate(route, { \n        relativeTo: this.route,\n        queryParams: { employeeId: this.employeeId } \n      });\n    } else {\n      this.router.navigate(route, { relativeTo: this.route });\n    }\n  }\n\n  delete(id: string) {\n    if (confirm('Are you sure you want to delete this request?')) {\n      this.requestService.delete(id)\n        .pipe(first())\n        .subscribe({\n          next: () => {\n            this.requests = this.requests.filter(x => x.id !== id);\n            this.alertService.success('Request deleted successfully');\n          },\n          error: error => {\n            console.error('Error deleting request:', error);\n            this.alertService.error('Failed to delete request');\n          }\n        });\n    }\n  }\n}","<div class=\"card\">\n  <div class=\"card-header\">\n    Requests\n    <ng-container *ngIf=\"employeeId && displayEmployeeId\">\n      for Employee {{displayEmployeeId}}\n    </ng-container>\n  </div>\n  <div class=\"card-body\">\n    <div *ngIf=\"loading\" class=\"text-center p-3\">\n      <span class=\"spinner-border spinner-border-sm me-1\"></span>\n      Loading requests...\n    </div>\n    \n    <div *ngIf=\"!loading\" class=\"table-responsive\">\n      <table class=\"table table-striped\">\n        <thead>\n          <tr>\n            <th>Type</th>\n            <th>Employee</th>\n            <th>Items</th>\n            <th>Status</th>\n            <th>Actions</th>\n          </tr>\n        </thead>\n        <tbody>\n          <tr *ngFor=\"let request of requests\">\n            <td>{{request.type}}</td>\n            <td>\n              <span *ngIf=\"request.Employee?.User?.email\">\n                {{request.Employee.User.email}} ({{request.Employee.User.role === 'Admin' ? 'Admin User' : 'Normal User'}})\n              </span>\n              <span *ngIf=\"!request.Employee?.User?.email && request.userEmail\">\n                {{request.userEmail}} ({{request.userRole === 'Admin' ? 'Admin User' : 'Normal User'}})\n              </span>\n              <span *ngIf=\"!request.Employee?.User?.email && !request.userEmail\">\n                Unknown\n              </span>\n            </td>\n            <td>\n              <ul class=\"list-unstyled mb-0\" *ngIf=\"(request.items && request.items.length > 0) || (request.requestItems && request.requestItems.length > 0)\">\n                <ng-container *ngIf=\"request.items && request.items.length > 0\">\n                  <li *ngFor=\"let item of request.items\">\n                    {{item.name}} (x{{item.quantity}})\n                  </li>\n                </ng-container>\n                <ng-container *ngIf=\"!request.items && request.requestItems && request.requestItems.length > 0\">\n                  <li *ngFor=\"let item of request.requestItems\">\n                    {{item.name}} (x{{item.quantity}})\n                  </li>\n                </ng-container>\n              </ul>\n              <span *ngIf=\"(!request.items || request.items.length === 0) && (!request.requestItems || request.requestItems.length === 0)\">No items</span>\n            </td>\n            <td>\n              <span class=\"badge\" [ngClass]=\"{\n                'bg-warning text-dark': request.status === 'Pending',\n                'bg-success': request.status === 'Approved' || request.status === 'Approve',\n                'bg-danger': request.status === 'Rejected' || request.status === 'Reject'\n              }\">\n                {{request.status}}\n              </span>\n            </td>\n            <td>\n              <button class=\"btn btn-sm btn-primary me-1\" [routerLink]=\"['edit', request.id]\">Edit</button>\n            </td>\n          </tr>\n          <tr *ngIf=\"requests.length === 0\">\n            <td colspan=\"5\" class=\"text-center\">No requests found</td>\n          </tr>\n        </tbody>\n      </table>\n    </div>\n    <button (click)=\"add()\" class=\"btn btn-primary float-end\">Add Request</button>\n  </div>\n</div>"]},"metadata":{},"sourceType":"module","externalDependencies":[]}