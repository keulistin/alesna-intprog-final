{"ast":null,"code":"import { first } from 'rxjs/operators';\nimport { Role } from '@app/_models';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@app/_services\";\nimport * as i2 from \"@angular/common\";\nimport * as i3 from \"@angular/router\";\nfunction ListComponent_tr_17_button_10_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r6 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 9);\n    i0.ɵɵlistener(\"click\", function ListComponent_tr_17_button_10_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r6);\n      const dept_r2 = i0.ɵɵnextContext().$implicit;\n      const ctx_r4 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r4.delete(dept_r2.id));\n    });\n    i0.ɵɵtext(1, \"Delete\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction ListComponent_tr_17_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\");\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"td\");\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"td\")(8, \"button\", 7);\n    i0.ɵɵtext(9, \"Edit\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(10, ListComponent_tr_17_button_10_Template, 2, 0, \"button\", 8);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const dept_r2 = ctx.$implicit;\n    const ctx_r0 = i0.ɵɵnextContext();\n    let tmp_3_0;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(dept_r2.name);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(dept_r2.description);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(dept_r2.employeeCount);\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"ngIf\", ((tmp_3_0 = ctx_r0.account()) == null ? null : tmp_3_0.role) === \"Admin\");\n  }\n}\nfunction ListComponent_button_18_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"button\", 10);\n    i0.ɵɵtext(1, \"Add Department\");\n    i0.ɵɵelementEnd();\n  }\n}\nexport let ListComponent = /*#__PURE__*/(() => {\n  class ListComponent {\n    constructor(departmentService, employeeService, alertService, accountService) {\n      var _a;\n      this.departmentService = departmentService;\n      this.employeeService = employeeService;\n      this.alertService = alertService;\n      this.accountService = accountService;\n      this.departments = [];\n      this.departmentToDelete = null; // Type it\n      this.showDeleteModal = false;\n      this.isAdmin = false;\n      this.isAdmin = ((_a = this.accountService.accountValue) === null || _a === void 0 ? void 0 : _a.role) === Role.Admin;\n    }\n    ngOnInit() {\n      this.loadDepartmentsWithEmployeeCounts();\n    }\n    loadDepartmentsWithEmployeeCounts() {\n      // First load all departments\n      this.departmentService.getAll().pipe(first()).subscribe({\n        next: departments => {\n          this.departments = departments;\n          this.employeeService.getAll().pipe(first()).subscribe({\n            next: employees => {\n              this.departments.forEach(dept => {\n                // Ensure type consistency for comparison if IDs are numbers\n                dept.employeeCount = employees.filter(emp => String(emp.departmentId) === String(dept.id) // Ensure both are strings for comparison\n                ).length;\n              });\n            },\n            error: empError => this.alertService.error(empError) // Handle error for employee loading\n          });\n        },\n\n        error: deptError => this.alertService.error(deptError) // Handle error for department loading\n      });\n    }\n\n    openDeleteModal(department) {\n      this.departmentToDelete = department;\n      this.showDeleteModal = true;\n      if (typeof document !== 'undefined') {\n        // Safeguard for SSR or non-browser environments\n        document.body.classList.add('modal-open');\n      }\n    }\n    confirmDelete() {\n      if (!this.departmentToDelete) return;\n      const department = this.departmentToDelete;\n      department.isDeleting = true;\n      this.departmentService.delete(String(department.id)).pipe(first()).subscribe({\n        next: () => {\n          this.departments = this.departments.filter(x => x.id !== department.id);\n          this.alertService.success('Department deleted successfully');\n          this.closeDeleteModal();\n        },\n        error: error => {\n          this.alertService.error(error);\n          department.isDeleting = false;\n          this.closeDeleteModal();\n        }\n      });\n    }\n    closeDeleteModal() {\n      this.showDeleteModal = false;\n      document.body.classList.remove('modal-open');\n      this.departmentToDelete = null;\n    }\n  }\n  ListComponent.ɵfac = function ListComponent_Factory(t) {\n    return new (t || ListComponent)(i0.ɵɵdirectiveInject(i1.DepartmentService), i0.ɵɵdirectiveInject(i1.EmployeeService), i0.ɵɵdirectiveInject(i1.AlertService), i0.ɵɵdirectiveInject(i1.AccountService));\n  };\n  ListComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: ListComponent,\n    selectors: [[\"ng-component\"]],\n    decls: 19,\n    vars: 2,\n    consts: [[1, \"card\"], [1, \"card-header\"], [1, \"card-body\"], [1, \"table-responsive\"], [1, \"table\", \"table-striped\"], [4, \"ngFor\", \"ngForOf\"], [\"class\", \"btn btn-primary float-end\", \"routerLink\", \"add\", 4, \"ngIf\"], [\"routerLink\", \"edit/dept.id\", 1, \"btn\", \"btn-sm\", \"btn-primary\", \"me-1\"], [\"class\", \"btn btn-sm btn-danger\", 3, \"click\", 4, \"ngIf\"], [1, \"btn\", \"btn-sm\", \"btn-danger\", 3, \"click\"], [\"routerLink\", \"add\", 1, \"btn\", \"btn-primary\", \"float-end\"]],\n    template: function ListComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1);\n        i0.ɵɵtext(2, \"Departments\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(3, \"div\", 2)(4, \"div\", 3)(5, \"table\", 4)(6, \"thead\")(7, \"tr\")(8, \"th\");\n        i0.ɵɵtext(9, \"Name\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(10, \"th\");\n        i0.ɵɵtext(11, \"Description\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(12, \"th\");\n        i0.ɵɵtext(13, \"Employee Count\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(14, \"th\");\n        i0.ɵɵtext(15, \"Actions\");\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵelementStart(16, \"tbody\");\n        i0.ɵɵtemplate(17, ListComponent_tr_17_Template, 11, 4, \"tr\", 5);\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵtemplate(18, ListComponent_button_18_Template, 2, 0, \"button\", 6);\n        i0.ɵɵelementEnd()();\n      }\n      if (rf & 2) {\n        i0.ɵɵadvance(17);\n        i0.ɵɵproperty(\"ngForOf\", ctx.departments);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.isAdmin);\n      }\n    },\n    dependencies: [i2.NgForOf, i2.NgIf, i3.RouterLink],\n    styles: [\".modal-backdrop[_ngcontent-%COMP%] {\\n            position: fixed;\\n            top: 0;\\n            left: 0;\\n            width: 100%;\\n            height: 100%;\\n            background-color: rgba(0, 0, 0, 0.5);\\n            z-index: 1040;\\n        }\\n        .modal[_ngcontent-%COMP%] {\\n            position: fixed;\\n            top: 0;\\n            left: 0;\\n            width: 100%;\\n            height: 100%;\\n            z-index: 1050;\\n            overflow: auto;\\n            display: flex;\\n            align-items: center;\\n            justify-content: center;\\n        }\\n        .modal-dialog[_ngcontent-%COMP%] {\\n            width: 100%;\\n            max-width: 500px;\\n            margin: 1.75rem auto;\\n            position: relative;\\n        }\\n        .modal-content[_ngcontent-%COMP%] {\\n            position: relative;\\n            background-color: #fff;\\n            border-radius: 0.3rem;\\n            box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.5);\\n        }\\n        .modal-header[_ngcontent-%COMP%] {\\n            display: flex;\\n            align-items: center;\\n            justify-content: space-between;\\n            padding: 1rem;\\n            background-color: #f8f9fa;\\n            border-bottom: 1px solid #e9ecef;\\n            border-top-left-radius: 0.3rem;\\n            border-top-right-radius: 0.3rem;\\n        }\\n        .modal-body[_ngcontent-%COMP%] {\\n            padding: 1rem;\\n        }\\n        .modal-footer[_ngcontent-%COMP%] {\\n            display: flex;\\n            align-items: center;\\n            justify-content: flex-end;\\n            padding: 1rem;\\n            border-top: 1px solid #e9ecef;\\n        }\\n        .btn-close[_ngcontent-%COMP%] {\\n            background: transparent;\\n            border: 0;\\n            font-size: 1.5rem;\\n            font-weight: 700;\\n            color: #000;\\n            opacity: 0.5;\\n            cursor: pointer;\\n        }\\n        .show[_ngcontent-%COMP%] {\\n            display: flex !important;\\n        }\\n        .hide[_ngcontent-%COMP%] {\\n            display: none !important;\\n        }\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8uL3NyYy9hcHAvZGVwYXJ0bWVudHMvbGlzdC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtRQUNRO1lBQ0ksZUFBZTtZQUNmLE1BQU07WUFDTixPQUFPO1lBQ1AsV0FBVztZQUNYLFlBQVk7WUFDWixvQ0FBb0M7WUFDcEMsYUFBYTtRQUNqQjtRQUNBO1lBQ0ksZUFBZTtZQUNmLE1BQU07WUFDTixPQUFPO1lBQ1AsV0FBVztZQUNYLFlBQVk7WUFDWixhQUFhO1lBQ2IsY0FBYztZQUNkLGFBQWE7WUFDYixtQkFBbUI7WUFDbkIsdUJBQXVCO1FBQzNCO1FBQ0E7WUFDSSxXQUFXO1lBQ1gsZ0JBQWdCO1lBQ2hCLG9CQUFvQjtZQUNwQixrQkFBa0I7UUFDdEI7UUFDQTtZQUNJLGtCQUFrQjtZQUNsQixzQkFBc0I7WUFDdEIscUJBQXFCO1lBQ3JCLDRDQUE0QztRQUNoRDtRQUNBO1lBQ0ksYUFBYTtZQUNiLG1CQUFtQjtZQUNuQiw4QkFBOEI7WUFDOUIsYUFBYTtZQUNiLHlCQUF5QjtZQUN6QixnQ0FBZ0M7WUFDaEMsOEJBQThCO1lBQzlCLCtCQUErQjtRQUNuQztRQUNBO1lBQ0ksYUFBYTtRQUNqQjtRQUNBO1lBQ0ksYUFBYTtZQUNiLG1CQUFtQjtZQUNuQix5QkFBeUI7WUFDekIsYUFBYTtZQUNiLDZCQUE2QjtRQUNqQztRQUNBO1lBQ0ksdUJBQXVCO1lBQ3ZCLFNBQVM7WUFDVCxpQkFBaUI7WUFDakIsZ0JBQWdCO1lBQ2hCLFdBQVc7WUFDWCxZQUFZO1lBQ1osZUFBZTtRQUNuQjtRQUNBO1lBQ0ksd0JBQXdCO1FBQzVCO1FBQ0E7WUFDSSx3QkFBd0I7UUFDNUIiLCJzb3VyY2VzQ29udGVudCI6WyJcbiAgICAgICAgLm1vZGFsLWJhY2tkcm9wIHtcbiAgICAgICAgICAgIHBvc2l0aW9uOiBmaXhlZDtcbiAgICAgICAgICAgIHRvcDogMDtcbiAgICAgICAgICAgIGxlZnQ6IDA7XG4gICAgICAgICAgICB3aWR0aDogMTAwJTtcbiAgICAgICAgICAgIGhlaWdodDogMTAwJTtcbiAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6IHJnYmEoMCwgMCwgMCwgMC41KTtcbiAgICAgICAgICAgIHotaW5kZXg6IDEwNDA7XG4gICAgICAgIH1cbiAgICAgICAgLm1vZGFsIHtcbiAgICAgICAgICAgIHBvc2l0aW9uOiBmaXhlZDtcbiAgICAgICAgICAgIHRvcDogMDtcbiAgICAgICAgICAgIGxlZnQ6IDA7XG4gICAgICAgICAgICB3aWR0aDogMTAwJTtcbiAgICAgICAgICAgIGhlaWdodDogMTAwJTtcbiAgICAgICAgICAgIHotaW5kZXg6IDEwNTA7XG4gICAgICAgICAgICBvdmVyZmxvdzogYXV0bztcbiAgICAgICAgICAgIGRpc3BsYXk6IGZsZXg7XG4gICAgICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyO1xuICAgICAgICAgICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7XG4gICAgICAgIH1cbiAgICAgICAgLm1vZGFsLWRpYWxvZyB7XG4gICAgICAgICAgICB3aWR0aDogMTAwJTtcbiAgICAgICAgICAgIG1heC13aWR0aDogNTAwcHg7XG4gICAgICAgICAgICBtYXJnaW46IDEuNzVyZW0gYXV0bztcbiAgICAgICAgICAgIHBvc2l0aW9uOiByZWxhdGl2ZTtcbiAgICAgICAgfVxuICAgICAgICAubW9kYWwtY29udGVudCB7XG4gICAgICAgICAgICBwb3NpdGlvbjogcmVsYXRpdmU7XG4gICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjZmZmO1xuICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogMC4zcmVtO1xuICAgICAgICAgICAgYm94LXNoYWRvdzogMCAwLjVyZW0gMXJlbSByZ2JhKDAsIDAsIDAsIDAuNSk7XG4gICAgICAgIH1cbiAgICAgICAgLm1vZGFsLWhlYWRlciB7XG4gICAgICAgICAgICBkaXNwbGF5OiBmbGV4O1xuICAgICAgICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjtcbiAgICAgICAgICAgIGp1c3RpZnktY29udGVudDogc3BhY2UtYmV0d2VlbjtcbiAgICAgICAgICAgIHBhZGRpbmc6IDFyZW07XG4gICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjZjhmOWZhO1xuICAgICAgICAgICAgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkICNlOWVjZWY7XG4gICAgICAgICAgICBib3JkZXItdG9wLWxlZnQtcmFkaXVzOiAwLjNyZW07XG4gICAgICAgICAgICBib3JkZXItdG9wLXJpZ2h0LXJhZGl1czogMC4zcmVtO1xuICAgICAgICB9XG4gICAgICAgIC5tb2RhbC1ib2R5IHtcbiAgICAgICAgICAgIHBhZGRpbmc6IDFyZW07XG4gICAgICAgIH1cbiAgICAgICAgLm1vZGFsLWZvb3RlciB7XG4gICAgICAgICAgICBkaXNwbGF5OiBmbGV4O1xuICAgICAgICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjtcbiAgICAgICAgICAgIGp1c3RpZnktY29udGVudDogZmxleC1lbmQ7XG4gICAgICAgICAgICBwYWRkaW5nOiAxcmVtO1xuICAgICAgICAgICAgYm9yZGVyLXRvcDogMXB4IHNvbGlkICNlOWVjZWY7XG4gICAgICAgIH1cbiAgICAgICAgLmJ0bi1jbG9zZSB7XG4gICAgICAgICAgICBiYWNrZ3JvdW5kOiB0cmFuc3BhcmVudDtcbiAgICAgICAgICAgIGJvcmRlcjogMDtcbiAgICAgICAgICAgIGZvbnQtc2l6ZTogMS41cmVtO1xuICAgICAgICAgICAgZm9udC13ZWlnaHQ6IDcwMDtcbiAgICAgICAgICAgIGNvbG9yOiAjMDAwO1xuICAgICAgICAgICAgb3BhY2l0eTogMC41O1xuICAgICAgICAgICAgY3Vyc29yOiBwb2ludGVyO1xuICAgICAgICB9XG4gICAgICAgIC5zaG93IHtcbiAgICAgICAgICAgIGRpc3BsYXk6IGZsZXggIWltcG9ydGFudDtcbiAgICAgICAgfVxuICAgICAgICAuaGlkZSB7XG4gICAgICAgICAgICBkaXNwbGF5OiBub25lICFpbXBvcnRhbnQ7XG4gICAgICAgIH1cbiAgICAiXSwic291cmNlUm9vdCI6IiJ9 */\"]\n  });\n  return ListComponent;\n})();","map":{"version":3,"mappings":"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","names":["first","Role","i0","ListComponent","constructor","departmentService","employeeService","alertService","accountService","isAdmin","accountValue","role","Admin","ngOnInit","loadDepartmentsWithEmployeeCounts","getAll","pipe","subscribe","next","departments","employees","forEach","dept","employeeCount","filter","emp","String","departmentId","id","length","error","empError","deptError","openDeleteModal","department","departmentToDelete","showDeleteModal","document","body","classList","add","confirmDelete","isDeleting","delete","x","success","closeDeleteModal","remove","selectors","decls","vars","consts","template"],"sourceRoot":"","sources":["E:\\semifinals\\groupB-fullstack-app\\frontend\\src\\app\\departments\\list.component.ts","E:\\semifinals\\groupB-fullstack-app\\frontend\\src\\app\\departments\\list.component.html"],"sourcesContent":["import { Component, OnInit } from '@angular/core';\r\nimport { first } from 'rxjs/operators';\r\n\r\nimport { DepartmentService, AlertService, EmployeeService, AccountService } from '@app/_services';\r\nimport { Department } from '@app/_models/department';\r\nimport { Role } from '@app/_models';\r\n\r\n@Component({\r\n    templateUrl: 'list.component.html',\r\n    styles: [`\r\n        .modal-backdrop {\r\n            position: fixed;\r\n            top: 0;\r\n            left: 0;\r\n            width: 100%;\r\n            height: 100%;\r\n            background-color: rgba(0, 0, 0, 0.5);\r\n            z-index: 1040;\r\n        }\r\n        .modal {\r\n            position: fixed;\r\n            top: 0;\r\n            left: 0;\r\n            width: 100%;\r\n            height: 100%;\r\n            z-index: 1050;\r\n            overflow: auto;\r\n            display: flex;\r\n            align-items: center;\r\n            justify-content: center;\r\n        }\r\n        .modal-dialog {\r\n            width: 100%;\r\n            max-width: 500px;\r\n            margin: 1.75rem auto;\r\n            position: relative;\r\n        }\r\n        .modal-content {\r\n            position: relative;\r\n            background-color: #fff;\r\n            border-radius: 0.3rem;\r\n            box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.5);\r\n        }\r\n        .modal-header {\r\n            display: flex;\r\n            align-items: center;\r\n            justify-content: space-between;\r\n            padding: 1rem;\r\n            background-color: #f8f9fa;\r\n            border-bottom: 1px solid #e9ecef;\r\n            border-top-left-radius: 0.3rem;\r\n            border-top-right-radius: 0.3rem;\r\n        }\r\n        .modal-body {\r\n            padding: 1rem;\r\n        }\r\n        .modal-footer {\r\n            display: flex;\r\n            align-items: center;\r\n            justify-content: flex-end;\r\n            padding: 1rem;\r\n            border-top: 1px solid #e9ecef;\r\n        }\r\n        .btn-close {\r\n            background: transparent;\r\n            border: 0;\r\n            font-size: 1.5rem;\r\n            font-weight: 700;\r\n            color: #000;\r\n            opacity: 0.5;\r\n            cursor: pointer;\r\n        }\r\n        .show {\r\n            display: flex !important;\r\n        }\r\n        .hide {\r\n            display: none !important;\r\n        }\r\n    `]\r\n})\r\nexport class ListComponent implements OnInit {\r\n    departments: Department[] = [];\r\n    departmentToDelete: Department | null = null; // Type it\r\n    showDeleteModal = false;\r\n    isAdmin = false;\r\n\r\n    constructor(\r\n        private departmentService: DepartmentService,\r\n        private employeeService: EmployeeService,\r\n        private alertService: AlertService,\r\n        private accountService: AccountService\r\n    ) {\r\n        this.isAdmin = this.accountService.accountValue?.role === Role.Admin;\r\n    }\r\n\r\n    ngOnInit() {\r\n        this.loadDepartmentsWithEmployeeCounts();\r\n    }\r\n\r\n    private loadDepartmentsWithEmployeeCounts() {\r\n        // First load all departments\r\n        this.departmentService.getAll()\r\n            .pipe(first())\r\n            .subscribe({\r\n                next: departments => {\r\n                    this.departments = departments;\r\n                    this.employeeService.getAll()\r\n                        .pipe(first())\r\n                        .subscribe({\r\n                            next: employees => {\r\n                                this.departments.forEach(dept => {\r\n                                    // Ensure type consistency for comparison if IDs are numbers\r\n                                    dept.employeeCount = employees.filter(emp =>\r\n                                        String(emp.departmentId) === String(dept.id) // Ensure both are strings for comparison\r\n                                    ).length;\r\n                                });\r\n                            },\r\n                            error: empError => this.alertService.error(empError) // Handle error for employee loading\r\n                        });\r\n                },\r\n                error: deptError => this.alertService.error(deptError) // Handle error for department loading\r\n            });\r\n    }\r\n\r\n    openDeleteModal(department: Department) { // Type the parameter\r\n        this.departmentToDelete = department;\r\n        this.showDeleteModal = true;\r\n        if (typeof document !== 'undefined') { // Safeguard for SSR or non-browser environments\r\n            document.body.classList.add('modal-open');\r\n        }\r\n    }\r\n\r\n    confirmDelete() {\r\n        if (!this.departmentToDelete) return;\r\n\r\n        const department = this.departmentToDelete;\r\n        department.isDeleting = true;\r\n\r\n        this.departmentService.delete(String(department.id))\r\n            .pipe(first())\r\n            .subscribe({\r\n                next: () => {\r\n                    this.departments = this.departments.filter(x => x.id !== department.id);\r\n                    this.alertService.success('Department deleted successfully');\r\n                    this.closeDeleteModal();\r\n                },\r\n                error: error => {\r\n                    this.alertService.error(error);\r\n                    department.isDeleting = false;\r\n                    this.closeDeleteModal();\r\n                }\r\n            });\r\n    }\r\n\r\n    closeDeleteModal() {\r\n        this.showDeleteModal = false;\r\n        document.body.classList.remove('modal-open');\r\n        this.departmentToDelete = null;\r\n    }\r\n} ","<div class=\"card\">\r\n    <div class=\"card-header\">Departments</div>\r\n    <div class=\"card-body\">\r\n        <div class=\"table-responsive\">\r\n            <table class=\"table table-striped\">\r\n                <thead>\r\n                    <tr>\r\n                        <th>Name</th>\r\n                        <th>Description</th>\r\n                        <th>Employee Count</th>\r\n                        <th>Actions</th>\r\n                    </tr>\r\n                </thead>\r\n                <tbody>\r\n                    <tr *ngFor=\"let dept of departments\">\r\n                        <td>{{dept.name}}</td>\r\n                        <td>{{dept.description}}</td>\r\n                        <td>{{dept.employeeCount}}</td>\r\n                        <td>\r\n                            <button class=\"btn btn-sm btn-primary me-1\" routerLink=\"edit/dept.id\">Edit</button>\r\n                            <button *ngIf=\"account()?.role === 'Admin'\" class=\"btn btn-sm btn-danger\"\r\n                                (click)=\"delete(dept.id)\">Delete</button>\r\n                        </td>\r\n                    </tr>\r\n                </tbody>\r\n            </table>\r\n        </div>\r\n        <button *ngIf=\"isAdmin\" class=\"btn btn-primary float-end\" routerLink=\"add\">Add Department</button>\r\n    </div>\r\n</div>"]},"metadata":{},"sourceType":"module","externalDependencies":[]}