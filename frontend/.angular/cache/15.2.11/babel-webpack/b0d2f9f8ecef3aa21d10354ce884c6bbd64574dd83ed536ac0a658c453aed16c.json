{"ast":null,"code":"import { HttpResponse, HTTP_INTERCEPTORS } from '@angular/common/http';\nimport { of, throwError } from 'rxjs';\nimport { delay, mergeMap, materialize, dematerialize } from 'rxjs/operators';\nimport { Role } from '@app/_models';\nimport { environment } from '@environments/environment';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@app/_services\";\n// array in local storage for accounts\nconst accountsKey = 'angular-10-registration-login-example-accounts';\nlet accounts = JSON.parse(localStorage.getItem(accountsKey)) || [];\n// in-memory data\nlet employees = [{\n  id: 1,\n  employeeId: 'EMP001',\n  userId: 1,\n  position: 'Developer',\n  departmentId: 1,\n  hireDate: '2025-01-01',\n  status: 'Active'\n}, {\n  id: 2,\n  employeeId: 'EMP002',\n  userId: 2,\n  position: 'Designer',\n  departmentId: 2,\n  hireDate: '2025-02-01',\n  status: 'Active'\n}];\nlet departments = [{\n  id: 1,\n  name: 'Engineering',\n  description: 'Software development team',\n  employeeCount: 1\n}, {\n  id: 2,\n  name: 'Marketing',\n  description: 'Marketing team',\n  employeeCount: 1\n}];\nlet workflows = [{\n  id: 1,\n  employeeId: 1,\n  type: 'Onboarding',\n  details: 'Task: Setup workstation',\n  status: 'Pending'\n}];\nlet requests = [{\n  id: 1,\n  employeeId: 1,\n  type: 'Equipment',\n  requestItems: [{\n    name: 'Laptop',\n    quantity: 1\n  }, {\n    name: 'Monitor',\n    quantity: 2\n  }],\n  status: 'Pending'\n}, {\n  id: 2,\n  employeeId: 1,\n  type: 'Software',\n  requestItems: [{\n    name: 'Visual Studio',\n    quantity: 1\n  }, {\n    name: 'Office 365',\n    quantity: 1\n  }],\n  status: 'Approved'\n}, {\n  id: 3,\n  employeeId: 2,\n  type: 'Training',\n  requestItems: [{\n    name: 'Adobe Illustrator Course',\n    quantity: 1\n  }],\n  status: 'Rejected'\n}, {\n  id: 4,\n  employeeId: 2,\n  type: 'Equipment',\n  requestItems: [{\n    name: 'Drawing Tablet',\n    quantity: 1\n  }],\n  status: 'Pending'\n}];\nexport let FakeBackendInterceptor = /*#__PURE__*/(() => {\n  class FakeBackendInterceptor {\n    constructor(alertService) {\n      this.alertService = alertService;\n    }\n    intercept(request, next) {\n      const {\n        url,\n        method,\n        headers,\n        body\n      } = request;\n      const alertService = this.alertService;\n      // Extract the path from the URL (remove the API prefix if present)\n      const apiUrl = environment.apiUrl;\n      const path = url.startsWith(apiUrl) ? url.substring(apiUrl.length) : url;\n      return of(null).pipe(mergeMap(() => handleRoute())).pipe(materialize()).pipe(delay(500)).pipe(dematerialize());\n      function handleRoute() {\n        switch (true) {\n          // Account endpoints\n          case path.endsWith('/accounts/authenticate') && method === 'POST':\n            return authenticate();\n          case path.endsWith('/accounts/refresh-token') && method === 'POST':\n            return refreshToken();\n          case path.endsWith('/accounts/revoke-token') && method === 'POST':\n            return revokeToken();\n          case path.endsWith('/accounts/register') && method === 'POST':\n            return register();\n          case path.endsWith('/accounts/verify-email') && method === 'POST':\n            return verifyEmail();\n          case path.endsWith('/accounts/forgot-password') && method === 'POST':\n            return forgotPassword();\n          case path.endsWith('/accounts/validate-reset-token') && method === 'POST':\n            return validateResetToken();\n          case path.endsWith('/accounts/reset-password') && method === 'POST':\n            return resetPassword();\n          case path.endsWith('/accounts') && method === 'GET':\n            return getAccounts();\n          case path.match(/\\/accounts\\/\\d+$/) && method === 'GET':\n            return getAccountById();\n          case path.endsWith('/accounts') && method === 'POST':\n            return createAccount();\n          case path.match(/\\/accounts\\/\\d+$/) && method === 'PUT':\n            return updateAccount();\n          // Employee endpoints\n          case path.endsWith('/employees') && method === 'GET':\n            return authorize(null, () => getEmployees());\n          case path.endsWith('/employees/nextId') && method === 'GET':\n            return authorize(null, () => getNextEmployeeId());\n          case path.endsWith('/employees') && method === 'POST':\n            return authorize(Role.Admin, () => createEmployee());\n          case path.match(/\\/employees\\/\\d+$/) && method === 'GET':\n            return authorize(null, () => getEmployeeById());\n          case path.match(/\\/employees\\/\\d+\\/with-details$/) && method === 'GET':\n            return authorize(null, () => getEmployeeWithDetails());\n          case path.match(/\\/employees\\/\\d+$/) && method === 'PUT':\n            return authorize(Role.Admin, () => updateEmployee());\n          case path.match(/\\/employees\\/\\d+\\/transfer$/) && method === 'POST':\n            return authorize(Role.Admin, () => transferEmployee());\n          // Department endpoints\n          case path.endsWith('/departments') && method === 'GET':\n            return authorize(null, () => getDepartments());\n          case path.endsWith('/departments') && method === 'POST':\n            return authorize(Role.Admin, () => createDepartment());\n          case path.match(/\\/departments\\/\\d+$/) && method === 'GET':\n            return authorize(null, () => getDepartmentById());\n          case path.match(/\\/departments\\/\\d+$/) && method === 'PUT':\n            return authorize(Role.Admin, () => updateDepartment());\n          // Workflow endpoints\n          case path.match(/\\/workflows\\/employee\\/\\d+$/) && method === 'GET':\n            return authorize(null, () => getEmployeeWorkflows());\n          case path.endsWith('/workflows') && method === 'GET':\n            return authorize(null, () => getAllWorkflows());\n          case path.endsWith('/workflows') && method === 'POST':\n            return authorize(Role.Admin, () => createWorkflow());\n          case path.match(/\\/workflows\\/\\d+\\/status$/) && method === 'PUT':\n            return authorize(Role.Admin, () => updateWorkflow());\n          case path.match(/\\/workflows\\/\\d+$/) && method === 'PUT':\n            return authorize(Role.Admin, () => updateWorkflow());\n          // Request endpoints\n          case path.endsWith('/requests') && method === 'GET':\n            return authorize(null, () => getRequests());\n          case path.match(/\\/requests\\?employeeId=\\d+$/) && method === 'GET':\n            return authorize(null, () => getRequestsByEmployeeId());\n          case path.match(/\\/requests\\/\\d+$/) && method === 'GET':\n            return authorize(null, () => getRequestById());\n          case path.endsWith('/requests') && method === 'POST':\n            return authorize(null, () => createRequest());\n          case path.match(/\\/requests\\/\\d+$/) && method === 'PUT':\n            return authorize(Role.Admin, () => updateRequest());\n          default:\n            // pass through any requests not handled above\n            return next.handle(request);\n        }\n      }\n      // Account route functions\n      function authenticate() {\n        const {\n          email,\n          password\n        } = body;\n        const account = accounts.find(x => x.email === email);\n        if (!account) {\n          return error('Email does not exist');\n        }\n        if (!account.isVerified) {\n          // Display verification email alert\n          setTimeout(() => {\n            const verifyUrl = `${location.origin}/account/verify-email?token=${account.verificationToken}`;\n            alertService.info(`\n                        <h4>Verification Email</h4>\n                        <p>Please click the below link to verify your email address:</p>\n                        <p><a href=\"${verifyUrl}\">${verifyUrl}</a></p>\n                    `, {\n              autoClose: false\n            });\n          }, 1000);\n          return error('Email is not yet verified');\n        }\n        if (account.password !== password) {\n          return error('Incorrect password');\n        }\n        if (account.status !== 'Active') {\n          return error('Account is inactive. Please contact support.');\n        }\n        account.refreshTokens.push(generateRefreshToken());\n        localStorage.setItem(accountsKey, JSON.stringify(accounts));\n        return ok(Object.assign(Object.assign({}, basicDetails(account)), {\n          jwtToken: generateJwtToken(account)\n        }));\n      }\n      function refreshToken() {\n        const refreshToken = getRefreshToken();\n        if (!refreshToken) return unauthorized();\n        const account = accounts.find(x => x.refreshTokens.includes(refreshToken));\n        if (!account) return unauthorized();\n        // replace old refresh token with a new one and save\n        account.refreshTokens = account.refreshTokens.filter(x => x !== refreshToken);\n        account.refreshTokens.push(generateRefreshToken());\n        localStorage.setItem(accountsKey, JSON.stringify(accounts));\n        return ok(Object.assign(Object.assign({}, basicDetails(account)), {\n          jwtToken: generateJwtToken(account)\n        }));\n      }\n      function revokeToken() {\n        if (!isAuthenticated()) return unauthorized();\n        const refreshToken = getRefreshToken();\n        const account = accounts.find(x => x.refreshTokens.includes(refreshToken));\n        // revoke token and save\n        account.refreshTokens = account.refreshTokens.filter(x => x !== refreshToken);\n        localStorage.setItem(accountsKey, JSON.stringify(accounts));\n        return ok();\n      }\n      function register() {\n        const account = body;\n        if (accounts.find(x => x.email === account.email)) {\n          // display email already registered message in alert\n          setTimeout(() => {\n            alertService.info(`\n                        <h4>Email Already Registered</h4>\n                        <p>Your email ${account.email} is already registered.</p>\n                        <p>If you don't know your password please visit the <a href=\"${location.origin}/account/forgot-password\">forgot password</a> page.</p>\n                        <div>\n                        <strong>NOTE:</strong> The fake backend displayed this \"email\" so you can test without an API. A real backend would send a real email.\n                        </div>\n                    `, {\n              autoclose: false\n            });\n          }, 1000);\n          // always return ok() response to prevent email enumeration\n          return ok();\n        }\n        // assign account id and a few other properties then save\n        account.id = newAccountId();\n        if (account.id === 1) {\n          // first registered account is an admin\n          account.role = Role.Admin;\n          account.status = 'Active'; // Admin accounts get active status\n        } else {\n          account.role = Role.User;\n          account.status = 'Inactive'; // User accounts get inacitve status upon creation\n        }\n\n        account.dateCreated = new Date().toISOString();\n        account.verificationToken = new Date().getTime().toString();\n        account.isVerified = false;\n        account.refreshTokens = [];\n        delete account.confirmPassword;\n        accounts.push(account);\n        localStorage.setItem(accountsKey, JSON.stringify(accounts));\n        // display verification email in alert\n        setTimeout(() => {\n          const verifyUrl = `${location.origin}/account/verify-email?token=${account.verificationToken}`;\n          alertService.info(`\n                    <h4>Verification Email</h4>\n                    <p>Thanks for registering!</p>\n                    <p>Please click the below link to verify your email address:</p>\n                    <p><a href=\"${verifyUrl}\">${verifyUrl}</a></p>\n                    <div><strong>NOTE:</strong> The fake backend displayed this \"email\" so you can test without an API. A real backend would send a real email.</div>\n                `, {\n            autoclose: false\n          });\n        }, 1000);\n        return ok();\n      }\n      function verifyEmail() {\n        const {\n          token\n        } = body;\n        const account = accounts.find(x => !!x.verificationToken && x.verificationToken === token);\n        if (!account) return error('Verification failed');\n        // set is verified flag to true if token is valid\n        account.isVerified = true;\n        localStorage.setItem(accountsKey, JSON.stringify(accounts));\n        return ok();\n      }\n      function forgotPassword() {\n        const {\n          email\n        } = body;\n        const account = accounts.find(x => x.email === email);\n        // always return ok() response to prevent email enumeration\n        if (!account) return ok();\n        // create reset token that expires after 24 hours\n        account.resetToken = new Date().getTime().toString();\n        account.resetTokenExpires = new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString();\n        localStorage.setItem(accountsKey, JSON.stringify(accounts));\n        // display password reset email in alert\n        setTimeout(() => {\n          const resetUrl = `${location.origin}/account/reset-password?token=${account.resetToken}`;\n          alertService.info(`\n                    <h4>Reset Password Email</h4>\n                    <p>Please click the below link to reset your password, the link will be valid for 1 day:</p>\n                    <p><a href=\"${resetUrl}\">${resetUrl}</a></p>\n                    <div><strong>NOTE:</strong> The fake backend displayed this \"email\" so you can test without an API. A real backend would send a real email.</div>\n                `, {\n            autoClose: false\n          });\n        }, 1000);\n        return ok();\n      }\n      function validateResetToken() {\n        const {\n          token\n        } = body;\n        const account = accounts.find(x => !!x.resetToken && x.resetToken === token && new Date() < new Date(x.resetTokenExpires));\n        if (!account) return error(\"Invalid token\");\n        return ok();\n      }\n      function resetPassword() {\n        const {\n          token,\n          password\n        } = body;\n        const account = accounts.find(x => !!x.resetToken && x.resetToken === token && new Date() < new Date(x.resetTokenExpires));\n        if (!account) return error('Invalid token');\n        // update password and remove reset token\n        account.password = password;\n        account.isVerified = true;\n        delete account.resetToken;\n        delete account.resetTokenExpires;\n        localStorage.setItem(accountsKey, JSON.stringify(accounts));\n        return ok();\n      }\n      function getAccounts() {\n        if (!isAuthenticated()) return unauthorized();\n        return ok(accounts.map(x => basicDetails(x)));\n      }\n      function getAccountById() {\n        if (!isAuthenticated()) return unauthorized();\n        let account = accounts.find(x => x.id === idFromUrl());\n        // user accounts can get own profile and admin accounts can get all profiles\n        if (account.id !== currentAccount().id && !isAuthorized(Role.Admin)) {\n          return unauthorized();\n        }\n        return ok(basicDetails(account));\n      }\n      function createAccount() {\n        if (!isAuthorized(Role.Admin)) return unauthorized();\n        const account = body;\n        if (accounts.find(x => x.email === account.email)) {\n          return error(`Email ${account.email} is already registered`);\n        }\n        // assign account id and a few other properties then save\n        account.id = newAccountId();\n        account.status = 'Inactive';\n        account.dateCreated = new Date().toISOString();\n        account.isVerified = true;\n        account.refreshTokens = [];\n        delete account.confirmPassword;\n        accounts.push(account);\n        localStorage.setItem(accountsKey, JSON.stringify(accounts));\n        return ok();\n      }\n      function updateAccount() {\n        if (!isAuthenticated()) return unauthorized();\n        let params = body;\n        let account = accounts.find(x => x.id == idFromUrl());\n        // user accounts can update own profile and admin accounts can update all profiles\n        if (account.id != currentAccount().id && !isAuthorized(Role.Admin)) {\n          return unauthorized();\n        }\n        // only update password if included\n        if (!params.password) {\n          delete params.password;\n        }\n        // update and save account\n        Object.assign(account, params);\n        localStorage.setItem(accountsKey, JSON.stringify(accounts));\n        return ok();\n      }\n      // Employee route functions\n      function getEmployees() {\n        // Map employees with account and department information\n        const enrichedEmployees = employees.map(employee => {\n          // Get user account details\n          const user = accounts.find(a => a.id === employee.userId);\n          // Get department details\n          const department = departments.find(d => d.id === employee.departmentId);\n          // Create a response with the related details\n          return Object.assign(Object.assign({}, employee), {\n            User: user ? {\n              id: user.id,\n              email: user.email,\n              role: user.role,\n              firstName: user.firstName,\n              lastName: user.lastName\n            } : null,\n            Department: department ? {\n              id: department.id,\n              name: department.name\n            } : null\n          });\n        });\n        return ok(enrichedEmployees);\n      }\n      function createEmployee() {\n        // Generate employee ID in format 'EMP' + padded number if not provided\n        let employeeId = body.employeeId;\n        if (!employeeId || !employeeId.trim()) {\n          const nextId = employees.length + 1;\n          employeeId = 'EMP' + nextId.toString().padStart(3, '0');\n        }\n        // Verify the userId exists in accounts\n        const userId = parseInt(body.userId);\n        if (isNaN(userId)) {\n          return error('Please select a valid user');\n        }\n        const userExists = accounts.some(a => a.id === userId);\n        if (!userExists) {\n          return error('User not found');\n        }\n        // Verify the departmentId exists\n        const departmentId = parseInt(body.departmentId);\n        if (isNaN(departmentId)) {\n          return error('Please select a valid department');\n        }\n        const department = departments.find(d => d.id === departmentId);\n        if (!department) {\n          return error('Department not found');\n        }\n        // Create the employee with auto-generated ID\n        const nextId = employees.length + 1;\n        const employee = {\n          id: nextId,\n          employeeId: employeeId,\n          userId: userId,\n          departmentId: departmentId,\n          position: body.position || '',\n          hireDate: body.hireDate || new Date().toISOString().split('T')[0],\n          status: body.status || 'Active'\n        };\n        // Add to employees array\n        employees.push(employee);\n        // Update department employee count\n        department.employeeCount++;\n        // Create onboarding workflow\n        workflows.push({\n          id: workflows.length + 1,\n          employeeId: nextId,\n          type: 'Onboarding',\n          details: 'Task: Setup workstation',\n          status: 'Pending'\n        });\n        return ok(employee);\n      }\n      function getEmployeeById() {\n        const id = parseInt(path.split('/').pop());\n        const employee = employees.find(e => e.id === id);\n        if (!employee) return error('Employee not found');\n        return ok(employee);\n      }\n      function getEmployeeWithDetails() {\n        const id = parseInt(path.split('/').pop().split('/')[0]);\n        const employee = employees.find(e => e.id === id);\n        if (!employee) return error('Employee not found');\n        // Get user account details\n        const user = accounts.find(a => a.id === employee.userId);\n        // Get department details\n        const department = departments.find(d => d.id === employee.departmentId);\n        // Create a response with the related details\n        const response = Object.assign(Object.assign({}, employee), {\n          User: user ? {\n            id: user.id,\n            email: user.email,\n            role: user.role\n          } : null,\n          Department: department ? {\n            id: department.id,\n            name: department.name\n          } : null\n        });\n        return ok(response);\n      }\n      function updateEmployee() {\n        const id = parseInt(path.split('/').pop());\n        const employeeIndex = employees.findIndex(e => e.id === id);\n        if (employeeIndex === -1) return error('Employee not found');\n        // Parse values to ensure they're numbers\n        let userId = body.userId;\n        if (userId && typeof userId === 'string') {\n          userId = parseInt(userId);\n        }\n        let departmentId = body.departmentId;\n        if (departmentId && typeof departmentId === 'string') {\n          departmentId = parseInt(departmentId);\n        }\n        // Check if user exists if userId is being updated\n        if (userId) {\n          const userExists = accounts.some(a => a.id === userId);\n          if (!userExists) {\n            return error('User not found');\n          }\n        }\n        // Check if department exists if departmentId is being updated\n        if (departmentId && departmentId !== employees[employeeIndex].departmentId) {\n          const oldDepartmentId = employees[employeeIndex].departmentId;\n          const oldDepartment = departments.find(d => d.id === oldDepartmentId);\n          const newDepartment = departments.find(d => d.id === departmentId);\n          if (!newDepartment) {\n            return error('Department not found');\n          }\n          // Update department employee counts\n          if (oldDepartment) oldDepartment.employeeCount--;\n          newDepartment.employeeCount++;\n        }\n        // Keep the employeeId unchanged\n        const employeeId = employees[employeeIndex].employeeId;\n        // Create updated employee object with parsed values\n        const updatedEmployee = {\n          id,\n          employeeId,\n          userId: userId || employees[employeeIndex].userId,\n          departmentId: departmentId || employees[employeeIndex].departmentId,\n          position: body.position || employees[employeeIndex].position,\n          hireDate: body.hireDate || employees[employeeIndex].hireDate,\n          status: body.status || employees[employeeIndex].status\n        };\n        // Update the employee\n        employees[employeeIndex] = updatedEmployee;\n        return ok(updatedEmployee);\n      }\n      function transferEmployee() {\n        const id = parseInt(path.split('/')[2]);\n        const employee = employees.find(e => e.id === id);\n        if (!employee) return error('Employee not found');\n        // Get department information\n        const oldDepartmentId = employee.departmentId;\n        const newDepartmentId = body.departmentId;\n        const oldDepartment = departments.find(d => d.id === oldDepartmentId);\n        const newDepartment = departments.find(d => d.id === newDepartmentId);\n        // Update employee's department\n        employee.departmentId = newDepartmentId;\n        // Update department counts\n        if (oldDepartment) oldDepartment.employeeCount--;\n        if (newDepartment) newDepartment.employeeCount++;\n        // Create transfer workflow\n        workflows.push({\n          id: workflows.length + 1,\n          employeeId: id,\n          type: 'Department Transfer',\n          details: `Employee transferred from ${(oldDepartment === null || oldDepartment === void 0 ? void 0 : oldDepartment.name) || 'Unknown'} to ${(newDepartment === null || newDepartment === void 0 ? void 0 : newDepartment.name) || 'Unknown'}.`,\n          status: 'Pending'\n        });\n        return ok({\n          message: 'Employee transferred successfully'\n        });\n      }\n      // Department route functions\n      function getDepartments() {\n        return ok(departments);\n      }\n      function getDepartmentById() {\n        const id = parseInt(path.split('/').pop());\n        const department = departments.find(d => d.id === id);\n        if (!department) return error('Department not found');\n        return ok(department);\n      }\n      function createDepartment() {\n        // Check if department with same name already exists\n        if (departments.some(d => d.name.toLowerCase() === body.name.toLowerCase())) {\n          return error('Department with this name already exists');\n        }\n        // Create department with initial employee count of 0\n        const department = {\n          id: departments.length + 1,\n          name: body.name,\n          description: body.description,\n          employeeCount: 0\n        };\n        departments.push(department);\n        return ok(department);\n      }\n      function updateDepartment() {\n        const id = parseInt(path.split('/').pop());\n        const deptIndex = departments.findIndex(d => d.id === id);\n        if (deptIndex === -1) return error('Department not found');\n        // Check if name is being changed and if it already exists\n        if (body.name && body.name !== departments[deptIndex].name) {\n          if (departments.some(d => d.id !== id && d.name.toLowerCase() === body.name.toLowerCase())) {\n            return error('Department with this name already exists');\n          }\n        }\n        // Update department\n        departments[deptIndex] = Object.assign(Object.assign({}, departments[deptIndex]), {\n          name: body.name || departments[deptIndex].name,\n          description: body.description || departments[deptIndex].description\n        });\n        return ok(departments[deptIndex]);\n      }\n      // Workflow route functions\n      function getEmployeeWorkflows() {\n        const employeeId = parseInt(path.split('/').pop());\n        return ok(workflows.filter(w => w.employeeId === employeeId));\n      }\n      function getAllWorkflows() {\n        return ok(workflows);\n      }\n      function createWorkflow() {\n        const workflow = Object.assign({\n          id: workflows.length + 1\n        }, body);\n        workflows.push(workflow);\n        return ok(workflow);\n      }\n      function updateWorkflow() {\n        // Handle both direct update and status update endpoints\n        let id;\n        if (path.includes('/workflows/') && path.includes('/status')) {\n          // Extract ID from paths like /workflows/123/status\n          id = parseInt(path.split('/')[2]);\n        } else {\n          // Standard path like /workflows/123\n          id = parseInt(path.split('/').pop());\n        }\n        const workflowIndex = workflows.findIndex(w => w.id === id);\n        if (workflowIndex === -1) return error('Workflow not found');\n        // Store previous status\n        const oldStatus = workflows[workflowIndex].status;\n        const oldWorkflow = Object.assign({}, workflows[workflowIndex]);\n        // Check if this is an update that includes a direct request for updating request status too\n        const updateRequestFlag = body.updateRequest === true;\n        let providedRequestId = body.requestId ? parseInt(body.requestId) : null;\n        // Create a new version of the body without the special properties\n        const workflowUpdateBody = Object.assign({}, body);\n        delete workflowUpdateBody.updateRequest;\n        delete workflowUpdateBody.requestId;\n        // Update workflow with clean data\n        workflows[workflowIndex] = Object.assign(Object.assign(Object.assign({}, workflows[workflowIndex]), workflowUpdateBody), {\n          id // preserve id\n        });\n        // If direct request flag was provided, prioritize using the provided requestId\n        if (updateRequestFlag && providedRequestId) {\n          console.log('Direct request to update request ID:', providedRequestId);\n          const requestIndex = requests.findIndex(r => r.id === providedRequestId);\n          if (requestIndex !== -1) {\n            // Update request status based on workflow status\n            if (body.status === 'Approved') {\n              requests[requestIndex].status = 'Approved';\n              console.log('Updated request status to Approved');\n            } else if (body.status === 'Rejected') {\n              requests[requestIndex].status = 'Rejected';\n              console.log('Updated request status to Rejected');\n            } else if (body.status === 'Pending') {\n              requests[requestIndex].status = 'Pending';\n              console.log('Updated request status to Pending');\n            }\n          } else {\n            console.log('Request not found with ID:', providedRequestId);\n          }\n        }\n        // Otherwise, try to extract requestId from workflow details (for backward compatibility)\n        else if ((workflows[workflowIndex].type === 'Request Approval' || workflows[workflowIndex].type === 'RequestApproval' || workflows[workflowIndex].type.includes('Request')) && body.status && body.status !== oldStatus) {\n          // Try to extract requestId from details field\n          const detailsText = workflows[workflowIndex].details || '';\n          console.log('Workflow details text:', detailsText);\n          // Extract requestId - first try to parse as JSON\n          let requestId = null;\n          try {\n            // Try to parse details as JSON\n            if (typeof detailsText === 'string') {\n              if (detailsText.trim().startsWith('{')) {\n                const detailsObj = JSON.parse(detailsText);\n                if (detailsObj.requestId) {\n                  requestId = parseInt(detailsObj.requestId.toString());\n                  console.log('Extracted requestId from JSON:', requestId);\n                }\n              }\n            } else if (typeof detailsText === 'object') {\n              // It's already an object\n              const detailsObj = detailsText;\n              if (detailsObj && detailsObj.requestId) {\n                requestId = parseInt(detailsObj.requestId.toString());\n                console.log('Extracted requestId from object:', requestId);\n              }\n            }\n          } catch (e) {\n            console.log('Failed to parse details as JSON:', e);\n          }\n          // If JSON parsing failed, try regex patterns\n          if (!requestId && typeof detailsText === 'string') {\n            // Try matching standard format with HTML bold tags\n            const boldMatch = detailsText.match(/<b>requestId:<\\/b>\\s*(\\d+)/i);\n            if (boldMatch && boldMatch[1]) {\n              requestId = parseInt(boldMatch[1]);\n            }\n            // Try matching without HTML tags\n            if (!requestId) {\n              const plainMatch = detailsText.match(/requestId:\\s*(\\d+)/i);\n              if (plainMatch && plainMatch[1]) {\n                requestId = parseInt(plainMatch[1]);\n              }\n            }\n            // Try extracting from any #NUMBER pattern if nothing else worked\n            if (!requestId) {\n              const hashMatch = detailsText.match(/request\\s+#(\\d+)/i);\n              if (hashMatch && hashMatch[1]) {\n                requestId = parseInt(hashMatch[1]);\n              }\n            }\n          }\n          console.log('Final extracted requestId:', requestId);\n          if (requestId) {\n            const requestIndex = requests.findIndex(r => r.id === requestId);\n            if (requestIndex !== -1) {\n              console.log('Found request at index:', requestIndex);\n              // Update request status based on workflow status\n              if (body.status === 'Approved') {\n                requests[requestIndex].status = 'Approved';\n                console.log('Updated request status to Approved');\n              } else if (body.status === 'Rejected') {\n                requests[requestIndex].status = 'Rejected';\n                console.log('Updated request status to Rejected');\n              } else if (body.status === 'Pending') {\n                requests[requestIndex].status = 'Pending';\n                console.log('Updated request status to Pending');\n              }\n            } else {\n              console.log('Request not found with ID:', requestId);\n            }\n          } else {\n            console.log('Could not extract requestId from details:', detailsText);\n          }\n        }\n        return ok(workflows[workflowIndex]);\n      }\n      // Request route functions\n      function getRequests() {\n        // Add employee and user information to requests\n        const requestsWithUserInfo = requests.map(request => {\n          const employee = employees.find(e => e.id === request.employeeId);\n          let userEmail = 'Unknown';\n          let userRole = 'Unknown';\n          if (employee) {\n            const user = accounts.find(a => a.id === employee.userId);\n            if (user) {\n              userEmail = user.email;\n              userRole = user.role;\n            }\n          }\n          return Object.assign(Object.assign({}, request), {\n            employee: employee ? {\n              id: employee.id,\n              employeeId: employee.employeeId\n            } : null,\n            userEmail,\n            userRole,\n            // Ensure requestItems is properly included\n            requestItems: request.requestItems || []\n          });\n        });\n        // If user is not an admin, only return their own requests\n        const account = currentAccount();\n        if (account && account.role !== Role.Admin) {\n          const employee = employees.find(e => e.userId === account.id);\n          if (employee) {\n            return ok(requestsWithUserInfo.filter(r => r.employeeId === employee.id));\n          }\n          return ok([]);\n        }\n        return ok(requestsWithUserInfo);\n      }\n      function getRequestById() {\n        const id = parseInt(path.split('/').pop());\n        const request = requests.find(r => r.id === id);\n        if (!request) return error('Request not found');\n        // Get employee and user information\n        const employee = employees.find(e => e.id === request.employeeId);\n        let userEmail = 'Unknown';\n        let userRole = 'Unknown';\n        if (employee) {\n          const user = accounts.find(a => a.id === employee.userId);\n          if (user) {\n            userEmail = user.email;\n            userRole = user.role;\n          }\n        }\n        // Check if the current user is allowed to view this request\n        const account = currentAccount();\n        if (account && account.role !== Role.Admin) {\n          const userEmployee = employees.find(e => e.userId === account.id);\n          if (!userEmployee || userEmployee.id !== request.employeeId) {\n            return error('You are not authorized to view this request');\n          }\n        }\n        // Return request with user and employee info\n        return ok(Object.assign(Object.assign({}, request), {\n          employee: employee ? {\n            id: employee.id,\n            employeeId: employee.employeeId\n          } : null,\n          userEmail,\n          userRole,\n          // Ensure requestItems is properly included\n          requestItems: request.requestItems || []\n        }));\n      }\n      function getRequestsByEmployeeId() {\n        const employeeIdParam = new URL(url).searchParams.get('employeeId');\n        if (!employeeIdParam) return error('Employee ID is required');\n        const employeeId = parseInt(employeeIdParam);\n        if (isNaN(employeeId)) return error('Invalid employee ID');\n        // Check if employee exists\n        const employee = employees.find(e => e.id === employeeId);\n        if (!employee) return error('Employee not found');\n        // Get user information\n        const user = accounts.find(a => a.id === employee.userId);\n        let userEmail = 'Unknown';\n        let userRole = 'Unknown';\n        if (user) {\n          userEmail = user.email;\n          userRole = user.role;\n        }\n        // Get department information\n        const department = departments.find(d => d.id === employee.departmentId);\n        // Filter requests by employee ID\n        const filteredRequests = requests.filter(r => r.employeeId === employeeId).map(request => Object.assign(Object.assign({}, request), {\n          Employee: Object.assign(Object.assign({}, employee), {\n            User: user ? {\n              id: user.id,\n              email: user.email,\n              role: user.role\n            } : null,\n            Department: department ? {\n              id: department.id,\n              name: department.name\n            } : null\n          }),\n          userEmail,\n          userRole,\n          // Ensure requestItems is properly included\n          requestItems: request.requestItems || []\n        }));\n        return ok(filteredRequests);\n      }\n      function createRequest() {\n        const account = currentAccount();\n        if (!account) return unauthorized();\n        // Use employeeId from body if provided (for admin users)\n        // Otherwise, find employee associated with current user\n        let employeeId;\n        if (body.employeeId && account.role === Role.Admin) {\n          // Admin users can create requests for any employee\n          employeeId = parseInt(body.employeeId);\n          // Verify that the employee exists\n          const employeeExists = employees.some(e => e.id === employeeId);\n          if (!employeeExists) {\n            return error('Selected employee not found');\n          }\n        } else {\n          // Regular users can only create requests for themselves\n          const employee = employees.find(e => e.userId === account.id);\n          if (!employee) {\n            return error('No employee record found for current user');\n          }\n          employeeId = employee.id;\n        }\n        // Find employee record for the request\n        const employee = employees.find(e => e.id === employeeId);\n        // Create request with proper structure\n        const request = {\n          id: requests.length + 1,\n          employeeId: employeeId,\n          type: body.type || 'Equipment',\n          status: 'Pending',\n          requestItems: body.requestItems ? body.requestItems.map(item => ({\n            name: item.name,\n            quantity: item.quantity || 1\n          })) : []\n        };\n        console.log('Creating new request:', request);\n        requests.push(request);\n        // Create workflow entry for request approval\n        workflows.push({\n          id: workflows.length + 1,\n          employeeId: employeeId,\n          type: 'Request Approval',\n          details: JSON.stringify({\n            requestId: request.id,\n            requestType: request.type,\n            requesterId: employeeId,\n            message: `Review ${request.type} request #${request.id} from Employee ID ${employee.employeeId}.`\n          }),\n          status: 'Pending'\n        });\n        return ok(request);\n      }\n      function updateRequest() {\n        const id = parseInt(path.split('/').pop());\n        const reqIndex = requests.findIndex(r => r.id === id);\n        if (reqIndex === -1) return error('Request not found');\n        // Log incoming request update\n        console.log('Updating request:', id, 'with data:', body);\n        // Preserve the employeeId\n        const employeeId = requests[reqIndex].employeeId;\n        const oldStatus = requests[reqIndex].status;\n        // Update the request - prioritize any provided fields or keep the existing values\n        requests[reqIndex] = {\n          id,\n          employeeId,\n          type: body.type || requests[reqIndex].type,\n          status: body.status || requests[reqIndex].status,\n          requestItems: body.requestItems ? body.requestItems.map(item => ({\n            name: item.name,\n            quantity: item.quantity || 1\n          })) : body.items ? body.items.map(item => ({\n            name: item.name,\n            quantity: item.quantity || 1\n          })) : requests[reqIndex].requestItems\n        };\n        console.log('Request updated:', requests[reqIndex]);\n        // Find employee info for the workflow\n        const employee = employees.find(e => e.id === employeeId);\n        if (!employee) return error('Employee not found');\n        // Create workflow entry if status changed\n        if (body.status && body.status !== oldStatus) {\n          workflows.push({\n            id: workflows.length + 1,\n            employeeId: employeeId,\n            type: 'Request Status Updated',\n            details: JSON.stringify({\n              requestId: id,\n              requestType: requests[reqIndex].type,\n              requesterId: employeeId,\n              message: `${requests[reqIndex].type} request #${id} from Employee ID ${employee.employeeId} was ${body.status.toLowerCase()}.`\n            }),\n            status: 'Completed'\n          });\n        }\n        // Create workflow for request edits if items changed\n        else if (body.items || body.requestItems) {\n          workflows.push({\n            id: workflows.length + 1,\n            employeeId: employeeId,\n            type: 'Request Approval',\n            details: JSON.stringify({\n              requestId: id,\n              requestType: requests[reqIndex].type,\n              requesterId: employeeId,\n              message: `Review updated ${requests[reqIndex].type} request #${id} from Employee ID ${employee.employeeId}.`\n            }),\n            status: 'Pending'\n          });\n        }\n        return ok(requests[reqIndex]);\n      }\n      function getNextEmployeeId() {\n        console.log('Fake backend: Getting next employee ID');\n        // Find the highest employee ID number\n        let maxId = 0;\n        employees.forEach(emp => {\n          if (emp.employeeId && emp.employeeId.startsWith('EMP')) {\n            const idNum = parseInt(emp.employeeId.substring(3));\n            if (!isNaN(idNum) && idNum > maxId) {\n              maxId = idNum;\n            }\n          }\n        });\n        // Generate the next ID (current max + 1)\n        const nextId = maxId + 1;\n        const nextEmployeeId = 'EMP' + nextId.toString().padStart(3, '0');\n        console.log('Fake backend generated next employee ID:', nextEmployeeId);\n        return ok({\n          employeeId: nextEmployeeId\n        });\n      }\n      // Helper functions\n      function ok(body) {\n        return of(new HttpResponse({\n          status: 200,\n          body\n        }));\n      }\n      function error(message) {\n        return throwError(() => ({\n          error: {\n            message\n          }\n        }));\n      }\n      function unauthorized() {\n        return throwError(() => ({\n          status: 401,\n          error: {\n            message: 'Unauthorized'\n          }\n        }));\n      }\n      function forbidden() {\n        return throwError(() => ({\n          status: 403,\n          error: {\n            message: 'Forbidden'\n          }\n        }));\n      }\n      function basicDetails(account) {\n        const {\n          id,\n          title,\n          firstName,\n          lastName,\n          email,\n          role,\n          dateCreated,\n          isVerified,\n          status\n        } = account;\n        return {\n          id,\n          title,\n          firstName,\n          lastName,\n          email,\n          role,\n          dateCreated,\n          isVerified,\n          status\n        };\n      }\n      function isAuthenticated() {\n        return !!currentAccount();\n      }\n      function isAuthorized(role) {\n        const account = currentAccount();\n        if (!account) return false;\n        return account.role === role;\n      }\n      function idFromUrl() {\n        const urlParts = path.split('/');\n        return parseInt(urlParts[urlParts.length - 1]);\n      }\n      function newAccountId() {\n        return accounts.length ? Math.max(...accounts.map(x => x.id)) + 1 : 1;\n      }\n      function currentAccount() {\n        // check if jwt token is in auth header\n        const authHeader = headers.get('Authorization');\n        if (!authHeader || !authHeader.startsWith('Bearer fake-jwt-token')) return;\n        // check if token is expired\n        const jwtToken = JSON.parse(atob(authHeader.split('.')[1]));\n        const tokenExpired = Date.now() > jwtToken.exp * 1000;\n        if (tokenExpired) return;\n        const account = accounts.find(x => x.id === jwtToken.id);\n        return account;\n      }\n      function generateJwtToken(account) {\n        // create token that expires in 15 minutes\n        const tokenPayload = {\n          exp: Math.round(new Date(Date.now() + 15 * 60 * 1000).getTime() / 1000),\n          id: account.id\n        };\n        return `fake-jwt-token.${btoa(JSON.stringify(tokenPayload))}`;\n      }\n      function generateRefreshToken() {\n        const token = new Date().getTime().toString();\n        // add token cookie that expires in 7 days\n        const expires = new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toUTCString();\n        document.cookie = `fakeRefreshToken=${token}; expires=${expires}; path=/`;\n        return token;\n      }\n      function getRefreshToken() {\n        // get refresh token from cookie\n        return (document.cookie.split(';').find(x => x.includes('fakeRefreshToken')) || '=').split('=')[1];\n      }\n      function authorize(requiredRole, success) {\n        if (!isAuthenticated()) return unauthorized();\n        if (requiredRole && !isAuthorized(requiredRole)) return forbidden();\n        return success();\n      }\n    }\n  }\n  FakeBackendInterceptor.ɵfac = function FakeBackendInterceptor_Factory(t) {\n    return new (t || FakeBackendInterceptor)(i0.ɵɵinject(i1.AlertService));\n  };\n  FakeBackendInterceptor.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n    token: FakeBackendInterceptor,\n    factory: FakeBackendInterceptor.ɵfac\n  });\n  return FakeBackendInterceptor;\n})();\nexport const fakeBackendProvider = {\n  provide: HTTP_INTERCEPTORS,\n  useClass: FakeBackendInterceptor,\n  multi: true\n};","map":{"version":3,"mappings":"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","names":["HttpResponse","HTTP_INTERCEPTORS","of","throwError","delay","mergeMap","materialize","dematerialize","Role","environment","accountsKey","accounts","JSON","parse","localStorage","getItem","employees","id","employeeId","userId","position","departmentId","hireDate","status","departments","name","description","employeeCount","workflows","type","details","requests","requestItems","quantity","FakeBackendInterceptor","constructor","alertService","intercept","request","next","url","method","headers","body","apiUrl","path","startsWith","substring","length","pipe","handleRoute","endsWith","authenticate","refreshToken","revokeToken","register","verifyEmail","forgotPassword","validateResetToken","resetPassword","getAccounts","match","getAccountById","createAccount","updateAccount","authorize","getEmployees","getNextEmployeeId","Admin","createEmployee","getEmployeeById","getEmployeeWithDetails","updateEmployee","transferEmployee","getDepartments","createDepartment","getDepartmentById","updateDepartment","getEmployeeWorkflows","getAllWorkflows","createWorkflow","updateWorkflow","getRequests","getRequestsByEmployeeId","getRequestById","createRequest","updateRequest","handle","email","password","account","find","x","error","isVerified","setTimeout","verifyUrl","location","origin","verificationToken","info","autoClose","refreshTokens","push","generateRefreshToken","setItem","stringify","ok","basicDetails","jwtToken","generateJwtToken","getRefreshToken","unauthorized","includes","filter","isAuthenticated","autoclose","newAccountId","role","User","dateCreated","Date","toISOString","getTime","toString","confirmPassword","token","resetToken","resetTokenExpires","now","resetUrl","map","idFromUrl","currentAccount","isAuthorized","params","Object","assign","enrichedEmployees","employee","user","a","department","d","firstName","lastName","Department","trim","nextId","padStart","parseInt","isNaN","userExists","some","split","pop","e","response","employeeIndex","findIndex","oldDepartmentId","oldDepartment","newDepartment","updatedEmployee","newDepartmentId","message","toLowerCase","deptIndex","w","workflow","workflowIndex","oldStatus","oldWorkflow","updateRequestFlag","providedRequestId","requestId","workflowUpdateBody","console","log","requestIndex","r","detailsText","detailsObj","boldMatch","plainMatch","hashMatch","requestsWithUserInfo","userEmail","userRole","userEmployee","employeeIdParam","URL","searchParams","get","filteredRequests","Employee","employeeExists","item","requestType","requesterId","reqIndex","items","maxId","forEach","emp","idNum","nextEmployeeId","forbidden","title","urlParts","Math","max","authHeader","atob","tokenExpired","exp","tokenPayload","round","btoa","expires","toUTCString","document","cookie","requiredRole","success","factory","fakeBackendProvider","provide","useClass","multi"],"sourceRoot":"","sources":["C:\\xampp\\htdocs\\groupB-fullstack-app\\frontend\\src\\app\\_helpers\\fake-backend.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\nimport { HttpRequest, HttpResponse, HttpHandler, HttpEvent, HttpInterceptor, HTTP_INTERCEPTORS, HttpHeaders } from '@angular/common/http';\nimport { Observable, of, throwError } from 'rxjs';\nimport { delay, mergeMap, materialize, dematerialize } from 'rxjs/operators';\n\nimport { AlertService } from '@app/_services';\nimport { Role } from '@app/_models';\nimport { environment } from '@environments/environment';\n\n// array in local storage for accounts\nconst accountsKey = 'angular-10-registration-login-example-accounts';\nlet accounts = JSON.parse(localStorage.getItem(accountsKey)) || [];\n\n// in-memory data\nlet employees = [\n    { id: 1, employeeId: 'EMP001', userId: 1, position: 'Developer', departmentId: 1, hireDate: '2025-01-01', status: 'Active' },\n    { id: 2, employeeId: 'EMP002', userId: 2, position: 'Designer', departmentId: 2, hireDate: '2025-02-01', status: 'Active' }\n];\n\nlet departments = [\n    { id: 1, name: 'Engineering', description: 'Software development team', employeeCount: 1 },\n    { id: 2, name: 'Marketing', description: 'Marketing team', employeeCount: 1 }\n];\n\nlet workflows = [\n    { id: 1, employeeId: 1, type: 'Onboarding', details: 'Task: Setup workstation', status: 'Pending' }\n];\n\nlet requests = [\n    { id: 1, employeeId: 1, type: 'Equipment', requestItems: [{ name: 'Laptop', quantity: 1 }, { name: 'Monitor', quantity: 2 }], status: 'Pending' },\n    { id: 2, employeeId: 1, type: 'Software', requestItems: [{ name: 'Visual Studio', quantity: 1 }, { name: 'Office 365', quantity: 1 }], status: 'Approved' },\n    { id: 3, employeeId: 2, type: 'Training', requestItems: [{ name: 'Adobe Illustrator Course', quantity: 1 }], status: 'Rejected' },\n    { id: 4, employeeId: 2, type: 'Equipment', requestItems: [{ name: 'Drawing Tablet', quantity: 1 }], status: 'Pending' }\n];\n\n@Injectable()\nexport class FakeBackendInterceptor implements HttpInterceptor {\n    constructor(private alertService: AlertService) { }\n\n    intercept(request: HttpRequest<any>, next: HttpHandler): Observable<HttpEvent<any>> {\n        const { url, method, headers, body } = request;\n        const alertService = this.alertService;\n\n        // Extract the path from the URL (remove the API prefix if present)\n        const apiUrl = environment.apiUrl;\n        const path = url.startsWith(apiUrl) ? url.substring(apiUrl.length) : url;\n\n        return of(null)\n            .pipe(mergeMap(() => handleRoute()))\n            .pipe(materialize())\n            .pipe(delay(500))\n            .pipe(dematerialize());\n\n        function handleRoute() {\n            switch (true) {\n                // Account endpoints\n                case path.endsWith('/accounts/authenticate') && method === 'POST':\n                    return authenticate();\n                case path.endsWith('/accounts/refresh-token') && method === 'POST':\n                    return refreshToken();\n                case path.endsWith('/accounts/revoke-token') && method === 'POST':\n                    return revokeToken();\n                case path.endsWith('/accounts/register') && method === 'POST':\n                    return register();\n                case path.endsWith('/accounts/verify-email') && method === 'POST':\n                    return verifyEmail();\n                case path.endsWith('/accounts/forgot-password') && method === 'POST':\n                    return forgotPassword();\n                case path.endsWith('/accounts/validate-reset-token') && method === 'POST':\n                    return validateResetToken();\n                case path.endsWith('/accounts/reset-password') && method === 'POST':\n                    return resetPassword();\n                case path.endsWith('/accounts') && method === 'GET':\n                    return getAccounts();\n                case path.match(/\\/accounts\\/\\d+$/) && method === 'GET':\n                    return getAccountById();\n                case path.endsWith('/accounts') && method === 'POST':\n                    return createAccount();\n                case path.match(/\\/accounts\\/\\d+$/) && method === 'PUT':\n                    return updateAccount();\n                \n                // Employee endpoints\n                case path.endsWith('/employees') && method === 'GET':\n                    return authorize(null, () => getEmployees());\n                case path.endsWith('/employees/nextId') && method === 'GET':\n                    return authorize(null, () => getNextEmployeeId());\n                case path.endsWith('/employees') && method === 'POST':\n                    return authorize(Role.Admin, () => createEmployee());\n                case path.match(/\\/employees\\/\\d+$/) && method === 'GET':\n                    return authorize(null, () => getEmployeeById());\n                case path.match(/\\/employees\\/\\d+\\/with-details$/) && method === 'GET':\n                    return authorize(null, () => getEmployeeWithDetails());\n                case path.match(/\\/employees\\/\\d+$/) && method === 'PUT':\n                    return authorize(Role.Admin, () => updateEmployee());\n                case path.match(/\\/employees\\/\\d+\\/transfer$/) && method === 'POST':\n                    return authorize(Role.Admin, () => transferEmployee());\n                \n                // Department endpoints\n                case path.endsWith('/departments') && method === 'GET':\n                    return authorize(null, () => getDepartments());\n                case path.endsWith('/departments') && method === 'POST':\n                    return authorize(Role.Admin, () => createDepartment());\n                case path.match(/\\/departments\\/\\d+$/) && method === 'GET':\n                    return authorize(null, () => getDepartmentById());\n                case path.match(/\\/departments\\/\\d+$/) && method === 'PUT':\n                    return authorize(Role.Admin, () => updateDepartment());\n                \n                // Workflow endpoints\n                case path.match(/\\/workflows\\/employee\\/\\d+$/) && method === 'GET':\n                    return authorize(null, () => getEmployeeWorkflows());\n                case path.endsWith('/workflows') && method === 'GET':\n                    return authorize(null, () => getAllWorkflows());\n                case path.endsWith('/workflows') && method === 'POST':\n                    return authorize(Role.Admin, () => createWorkflow());\n                case path.match(/\\/workflows\\/\\d+\\/status$/) && method === 'PUT':\n                    return authorize(Role.Admin, () => updateWorkflow());\n                case path.match(/\\/workflows\\/\\d+$/) && method === 'PUT':\n                    return authorize(Role.Admin, () => updateWorkflow());\n                \n                // Request endpoints\n                case path.endsWith('/requests') && method === 'GET':\n                    return authorize(null, () => getRequests());\n                case path.match(/\\/requests\\?employeeId=\\d+$/) && method === 'GET':\n                    return authorize(null, () => getRequestsByEmployeeId());\n                case path.match(/\\/requests\\/\\d+$/) && method === 'GET':\n                    return authorize(null, () => getRequestById());\n                case path.endsWith('/requests') && method === 'POST':\n                    return authorize(null, () => createRequest());\n                case path.match(/\\/requests\\/\\d+$/) && method === 'PUT':\n                    return authorize(Role.Admin, () => updateRequest());\n                \n                default:\n                    // pass through any requests not handled above\n                    return next.handle(request);\n            }\n        }\n\n        // Account route functions\n        function authenticate() {\n            const { email, password } = body;\n            const account = accounts.find(x => x.email === email);\n        \n            if (!account) {\n                return error('Email does not exist');\n            }\n        \n            if (!account.isVerified) {\n                // Display verification email alert\n                setTimeout(() => {\n                    const verifyUrl = `${location.origin}/account/verify-email?token=${account.verificationToken}`;\n                    alertService.info(`\n                        <h4>Verification Email</h4>\n                        <p>Please click the below link to verify your email address:</p>\n                        <p><a href=\"${verifyUrl}\">${verifyUrl}</a></p>\n                    `, { autoClose: false });\n                }, 1000);\n        \n                return error('Email is not yet verified');\n            }\n        \n            if (account.password !== password) {\n                return error('Incorrect password');\n            }\n        \n            if (account.status !== 'Active') {\n                return error('Account is inactive. Please contact support.');\n            }\n        \n            account.refreshTokens.push(generateRefreshToken());\n            localStorage.setItem(accountsKey, JSON.stringify(accounts));\n        \n            return ok({\n                ...basicDetails(account),\n                jwtToken: generateJwtToken(account)\n            });\n        }\n\n        function refreshToken() {\n            const refreshToken = getRefreshToken();\n\n            if (!refreshToken) return unauthorized();\n\n            const account = accounts.find(x => x.refreshTokens.includes(refreshToken));\n\n            if (!account) return unauthorized();\n\n            // replace old refresh token with a new one and save\n            account.refreshTokens = account.refreshTokens.filter(x => x !== refreshToken);\n            account.refreshTokens.push(generateRefreshToken());\n            localStorage.setItem(accountsKey, JSON.stringify(accounts));\n\n            return ok({\n                ...basicDetails(account),\n                jwtToken: generateJwtToken(account)\n            });\n        }\n\n        function revokeToken() {\n            if (!isAuthenticated()) return unauthorized();\n\n            const refreshToken = getRefreshToken();\n            const account = accounts.find(x => x.refreshTokens.includes(refreshToken));\n\n            // revoke token and save\n            account.refreshTokens = account.refreshTokens.filter(x => x !== refreshToken);\n            localStorage.setItem(accountsKey, JSON.stringify(accounts));\n\n            return ok();\n        }\n\n        function register() {\n            const account = body;\n\n            if (accounts.find(x => x.email === account.email)) {\n                // display email already registered message in alert\n                setTimeout(() => {\n                    alertService.info(`\n                        <h4>Email Already Registered</h4>\n                        <p>Your email ${account.email} is already registered.</p>\n                        <p>If you don't know your password please visit the <a href=\"${location.origin}/account/forgot-password\">forgot password</a> page.</p>\n                        <div>\n                        <strong>NOTE:</strong> The fake backend displayed this \"email\" so you can test without an API. A real backend would send a real email.\n                        </div>\n                    `, { autoclose: false });\n                }, 1000);\n\n                // always return ok() response to prevent email enumeration\n                return ok();\n            }\n\n            // assign account id and a few other properties then save\n            account.id = newAccountId();\n            if (account.id === 1) {\n                // first registered account is an admin\n                account.role = Role.Admin;\n                account.status = 'Active'; // Admin accounts get active status\n            } else {\n                account.role = Role.User;\n                account.status = 'Inactive'; // User accounts get inacitve status upon creation\n            }\n            account.dateCreated = new Date().toISOString();\n            account.verificationToken = new Date().getTime().toString();\n            account.isVerified = false;\n            account.refreshTokens = [];\n            delete account.confirmPassword;\n            accounts.push(account);\n            localStorage.setItem(accountsKey, JSON.stringify(accounts));\n\n            // display verification email in alert\n            setTimeout(() => {\n                const verifyUrl = `${location.origin}/account/verify-email?token=${account.verificationToken}`;\n                alertService.info(`\n                    <h4>Verification Email</h4>\n                    <p>Thanks for registering!</p>\n                    <p>Please click the below link to verify your email address:</p>\n                    <p><a href=\"${verifyUrl}\">${verifyUrl}</a></p>\n                    <div><strong>NOTE:</strong> The fake backend displayed this \"email\" so you can test without an API. A real backend would send a real email.</div>\n                `, { autoclose: false });\n            }, 1000);\n\n            return ok();\n        }\n\n        function verifyEmail() {\n            const { token } = body;\n            const account = accounts.find(x => !!x.verificationToken && x.verificationToken === token);\n\n            if (!account) return error('Verification failed');\n\n            // set is verified flag to true if token is valid\n            account.isVerified = true;\n            localStorage.setItem(accountsKey, JSON.stringify(accounts));\n\n            return ok();\n        }\n\n        function forgotPassword() {\n            const { email } = body;\n            const account = accounts.find(x => x.email === email);\n\n            // always return ok() response to prevent email enumeration\n            if (!account) return ok();\n\n            // create reset token that expires after 24 hours\n            account.resetToken = new Date().getTime().toString();\n            account.resetTokenExpires = new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString();\n            localStorage.setItem(accountsKey, JSON.stringify(accounts));\n\n            // display password reset email in alert\n            setTimeout(() => {\n                const resetUrl = `${location.origin}/account/reset-password?token=${account.resetToken}`;\n                alertService.info(`\n                    <h4>Reset Password Email</h4>\n                    <p>Please click the below link to reset your password, the link will be valid for 1 day:</p>\n                    <p><a href=\"${resetUrl}\">${resetUrl}</a></p>\n                    <div><strong>NOTE:</strong> The fake backend displayed this \"email\" so you can test without an API. A real backend would send a real email.</div>\n                `, { autoClose: false });\n            }, 1000);\n\n            return ok();\n        }\n\n        function validateResetToken() {\n            const { token } = body;\n            const account = accounts.find(x =>\n                !!x.resetToken &&\n                x.resetToken === token &&\n                new Date() < new Date(x.resetTokenExpires)\n            );\n\n            if (!account) return error(\"Invalid token\");\n\n            return ok();\n        }\n\n        function resetPassword() {\n            const { token, password } = body;\n            const account = accounts.find(x =>\n                !!x.resetToken && x.resetToken === token &&\n                new Date() < new Date(x.resetTokenExpires)\n            );\n\n            if (!account) return error('Invalid token');\n\n            // update password and remove reset token\n            account.password = password;\n            account.isVerified = true;\n            delete account.resetToken;\n            delete account.resetTokenExpires;\n            localStorage.setItem(accountsKey, JSON.stringify(accounts));\n\n            return ok();\n        }\n\n        function getAccounts() {\n            if (!isAuthenticated()) return unauthorized();\n            return ok(accounts.map(x => basicDetails(x)));\n        }\n\n        function getAccountById() {\n            if (!isAuthenticated()) return unauthorized();\n\n            let account = accounts.find(x => x.id === idFromUrl());\n\n            // user accounts can get own profile and admin accounts can get all profiles\n            if (account.id !== currentAccount().id && !isAuthorized(Role.Admin)) {\n                return unauthorized();\n            }\n\n            return ok(basicDetails(account));\n        }\n\n        function createAccount() {\n            if (!isAuthorized(Role.Admin)) return unauthorized();\n\n            const account = body;\n            if (accounts.find(x => x.email === account.email)) {\n                return error(`Email ${account.email} is already registered`);\n            }\n\n            // assign account id and a few other properties then save\n            account.id = newAccountId();\n            account.status = 'Inactive';\n            account.dateCreated = new Date().toISOString();\n            account.isVerified = true;\n            account.refreshTokens = [];\n            delete account.confirmPassword;\n            accounts.push(account);\n            localStorage.setItem(accountsKey, JSON.stringify(accounts));\n\n            return ok();\n        }\n\n        function updateAccount() {\n            if (!isAuthenticated()) return unauthorized();\n\n            let params = body;\n            let account = accounts.find(x => x.id == idFromUrl());\n\n            // user accounts can update own profile and admin accounts can update all profiles\n            if (account.id != currentAccount().id && !isAuthorized(Role.Admin)) {\n                return unauthorized();\n            }\n\n            // only update password if included\n            if (!params.password) {\n                delete params.password;\n            }\n\n            // update and save account\n            Object.assign(account, params);\n            localStorage.setItem(accountsKey, JSON.stringify(accounts));\n\n            return ok();\n        }\n\n        // Employee route functions\n        function getEmployees() {\n            // Map employees with account and department information\n            const enrichedEmployees = employees.map(employee => {\n                // Get user account details\n                const user = accounts.find(a => a.id === employee.userId);\n                \n                // Get department details\n                const department = departments.find(d => d.id === employee.departmentId);\n                \n                // Create a response with the related details\n                return {\n                    ...employee,\n                    User: user ? {\n                        id: user.id,\n                        email: user.email,\n                        role: user.role,\n                        firstName: user.firstName,\n                        lastName: user.lastName\n                    } : null,\n                    Department: department ? {\n                        id: department.id,\n                        name: department.name\n                    } : null\n                };\n            });\n            \n            return ok(enrichedEmployees);\n        }\n\n        function createEmployee() {\n            // Generate employee ID in format 'EMP' + padded number if not provided\n            let employeeId = body.employeeId;\n            if (!employeeId || !employeeId.trim()) {\n                const nextId = employees.length + 1;\n                employeeId = 'EMP' + nextId.toString().padStart(3, '0');\n            }\n            \n            // Verify the userId exists in accounts\n            const userId = parseInt(body.userId);\n            if (isNaN(userId)) {\n                return error('Please select a valid user');\n            }\n            \n            const userExists = accounts.some(a => a.id === userId);\n            if (!userExists) {\n                return error('User not found');\n            }\n            \n            // Verify the departmentId exists\n            const departmentId = parseInt(body.departmentId);\n            if (isNaN(departmentId)) {\n                return error('Please select a valid department');\n            }\n            \n            const department = departments.find(d => d.id === departmentId);\n            if (!department) {\n                return error('Department not found');\n            }\n            \n            // Create the employee with auto-generated ID\n            const nextId = employees.length + 1;\n            const employee = { \n                id: nextId, \n                employeeId: employeeId, \n                userId: userId,\n                departmentId: departmentId,\n                position: body.position || '',\n                hireDate: body.hireDate || new Date().toISOString().split('T')[0],\n                status: body.status || 'Active'\n            };\n            \n            // Add to employees array\n            employees.push(employee);\n            \n            // Update department employee count\n            department.employeeCount++;\n            \n            // Create onboarding workflow\n            workflows.push({\n                id: workflows.length + 1,\n                employeeId: nextId,\n                type: 'Onboarding',\n                details: 'Task: Setup workstation',\n                status: 'Pending'\n            });\n            \n            return ok(employee);\n        }\n\n        function getEmployeeById() {\n            const id = parseInt(path.split('/').pop()!);\n            const employee = employees.find(e => e.id === id);\n            if (!employee) return error('Employee not found');\n            return ok(employee);\n        }\n        \n        function getEmployeeWithDetails() {\n            const id = parseInt(path.split('/').pop().split('/')[0]);\n            const employee = employees.find(e => e.id === id);\n            \n            if (!employee) return error('Employee not found');\n            \n            // Get user account details\n            const user = accounts.find(a => a.id === employee.userId);\n            \n            // Get department details\n            const department = departments.find(d => d.id === employee.departmentId);\n            \n            // Create a response with the related details\n            const response = {\n                ...employee,\n                User: user ? {\n                    id: user.id,\n                    email: user.email,\n                    role: user.role\n                } : null,\n                Department: department ? {\n                    id: department.id,\n                    name: department.name\n                } : null\n            };\n            \n            return ok(response);\n        }\n\n        function updateEmployee() {\n            const id = parseInt(path.split('/').pop()!);\n            const employeeIndex = employees.findIndex(e => e.id === id);\n            \n            if (employeeIndex === -1) return error('Employee not found');\n            \n            // Parse values to ensure they're numbers\n            let userId = body.userId;\n            if (userId && typeof userId === 'string') {\n                userId = parseInt(userId);\n            }\n            \n            let departmentId = body.departmentId;\n            if (departmentId && typeof departmentId === 'string') {\n                departmentId = parseInt(departmentId);\n            }\n            \n            // Check if user exists if userId is being updated\n            if (userId) {\n                const userExists = accounts.some(a => a.id === userId);\n                if (!userExists) {\n                    return error('User not found');\n                }\n            }\n            \n            // Check if department exists if departmentId is being updated\n            if (departmentId && departmentId !== employees[employeeIndex].departmentId) {\n                const oldDepartmentId = employees[employeeIndex].departmentId;\n                \n                const oldDepartment = departments.find(d => d.id === oldDepartmentId);\n                const newDepartment = departments.find(d => d.id === departmentId);\n                \n                if (!newDepartment) {\n                    return error('Department not found');\n                }\n                \n                // Update department employee counts\n                if (oldDepartment) oldDepartment.employeeCount--;\n                newDepartment.employeeCount++;\n            }\n            \n            // Keep the employeeId unchanged\n            const employeeId = employees[employeeIndex].employeeId;\n            \n            // Create updated employee object with parsed values\n            const updatedEmployee = {\n                id,\n                employeeId,\n                userId: userId || employees[employeeIndex].userId,\n                departmentId: departmentId || employees[employeeIndex].departmentId,\n                position: body.position || employees[employeeIndex].position,\n                hireDate: body.hireDate || employees[employeeIndex].hireDate,\n                status: body.status || employees[employeeIndex].status\n            };\n            \n            // Update the employee\n            employees[employeeIndex] = updatedEmployee;\n            \n            return ok(updatedEmployee);\n        }\n\n        function transferEmployee() {\n            const id = parseInt(path.split('/')[2]);\n            const employee = employees.find(e => e.id === id);\n            if (!employee) return error('Employee not found');\n            \n            // Get department information\n            const oldDepartmentId = employee.departmentId;\n            const newDepartmentId = body.departmentId;\n            const oldDepartment = departments.find(d => d.id === oldDepartmentId);\n            const newDepartment = departments.find(d => d.id === newDepartmentId);\n            \n            // Update employee's department\n            employee.departmentId = newDepartmentId;\n            \n            // Update department counts\n            if (oldDepartment) oldDepartment.employeeCount--;\n            if (newDepartment) newDepartment.employeeCount++;\n            \n            // Create transfer workflow\n            workflows.push({\n                id: workflows.length + 1,\n                employeeId: id,\n                type: 'Department Transfer',\n                details: `Employee transferred from ${oldDepartment?.name || 'Unknown'} to ${newDepartment?.name || 'Unknown'}.`,\n                status: 'Pending'\n            });\n            \n            return ok({ message: 'Employee transferred successfully' });\n        }\n\n        // Department route functions\n        function getDepartments() {\n            return ok(departments);\n        }\n\n        function getDepartmentById() {\n            const id = parseInt(path.split('/').pop()!);\n            const department = departments.find(d => d.id === id);\n            \n            if (!department) return error('Department not found');\n            \n            return ok(department);\n        }\n\n        function createDepartment() {\n            // Check if department with same name already exists\n            if (departments.some(d => d.name.toLowerCase() === body.name.toLowerCase())) {\n                return error('Department with this name already exists');\n            }\n            \n            // Create department with initial employee count of 0\n            const department = { \n                id: departments.length + 1, \n                name: body.name,\n                description: body.description,\n                employeeCount: 0 \n            };\n            \n            departments.push(department);\n            return ok(department);\n        }\n\n        function updateDepartment() {\n            const id = parseInt(path.split('/').pop()!);\n            const deptIndex = departments.findIndex(d => d.id === id);\n            \n            if (deptIndex === -1) return error('Department not found');\n            \n            // Check if name is being changed and if it already exists\n            if (body.name && body.name !== departments[deptIndex].name) {\n                if (departments.some(d => d.id !== id && d.name.toLowerCase() === body.name.toLowerCase())) {\n                    return error('Department with this name already exists');\n                }\n            }\n            \n            // Update department\n            departments[deptIndex] = {\n                ...departments[deptIndex],\n                name: body.name || departments[deptIndex].name,\n                description: body.description || departments[deptIndex].description\n            };\n            \n            return ok(departments[deptIndex]);\n        }\n\n        // Workflow route functions\n        function getEmployeeWorkflows() {\n            const employeeId = parseInt(path.split('/').pop()!);\n            return ok(workflows.filter(w => w.employeeId === employeeId));\n        }\n\n        function getAllWorkflows() {\n            return ok(workflows);\n        }\n\n        function createWorkflow() {\n            const workflow = { id: workflows.length + 1, ...body };\n            workflows.push(workflow);\n            return ok(workflow);\n        }\n\n        function updateWorkflow() {\n            // Handle both direct update and status update endpoints\n            let id;\n            if (path.includes('/workflows/') && path.includes('/status')) {\n                // Extract ID from paths like /workflows/123/status\n                id = parseInt(path.split('/')[2]);\n            } else {\n                // Standard path like /workflows/123\n                id = parseInt(path.split('/').pop()!);\n            }\n            \n            const workflowIndex = workflows.findIndex(w => w.id === id);\n            \n            if (workflowIndex === -1) return error('Workflow not found');\n            \n            // Store previous status\n            const oldStatus = workflows[workflowIndex].status;\n            const oldWorkflow = { ...workflows[workflowIndex] };\n            \n            // Check if this is an update that includes a direct request for updating request status too\n            const updateRequestFlag = body.updateRequest === true;\n            let providedRequestId = body.requestId ? parseInt(body.requestId) : null;\n            \n            // Create a new version of the body without the special properties\n            const workflowUpdateBody: any = {...body};\n            delete workflowUpdateBody.updateRequest;\n            delete workflowUpdateBody.requestId;\n            \n            // Update workflow with clean data\n            workflows[workflowIndex] = {\n                ...workflows[workflowIndex],\n                ...workflowUpdateBody,\n                id // preserve id\n            };\n            \n            // If direct request flag was provided, prioritize using the provided requestId\n            if (updateRequestFlag && providedRequestId) {\n                console.log('Direct request to update request ID:', providedRequestId);\n                const requestIndex = requests.findIndex(r => r.id === providedRequestId);\n                \n                if (requestIndex !== -1) {\n                    // Update request status based on workflow status\n                    if (body.status === 'Approved') {\n                        requests[requestIndex].status = 'Approved';\n                        console.log('Updated request status to Approved');\n                    } else if (body.status === 'Rejected') {\n                        requests[requestIndex].status = 'Rejected';\n                        console.log('Updated request status to Rejected');\n                    } else if (body.status === 'Pending') {\n                        requests[requestIndex].status = 'Pending';\n                        console.log('Updated request status to Pending');\n                    }\n                } else {\n                    console.log('Request not found with ID:', providedRequestId);\n                }\n            }\n            // Otherwise, try to extract requestId from workflow details (for backward compatibility)\n            else if ((workflows[workflowIndex].type === 'Request Approval' || \n                 workflows[workflowIndex].type === 'RequestApproval' ||\n                 workflows[workflowIndex].type.includes('Request')) && \n                body.status && \n                body.status !== oldStatus) {\n                \n                // Try to extract requestId from details field\n                const detailsText = workflows[workflowIndex].details || '';\n                console.log('Workflow details text:', detailsText);\n                \n                // Extract requestId - first try to parse as JSON\n                let requestId = null;\n                try {\n                    // Try to parse details as JSON\n                    if (typeof detailsText === 'string') {\n                        if (detailsText.trim().startsWith('{')) {\n                            const detailsObj = JSON.parse(detailsText);\n                            if (detailsObj.requestId) {\n                                requestId = parseInt(detailsObj.requestId.toString());\n                                console.log('Extracted requestId from JSON:', requestId);\n                            }\n                        }\n                    } else if (typeof detailsText === 'object') {\n                        // It's already an object\n                        const detailsObj = detailsText as any;\n                        if (detailsObj && detailsObj.requestId) {\n                            requestId = parseInt(detailsObj.requestId.toString());\n                            console.log('Extracted requestId from object:', requestId);\n                        }\n                    }\n                } catch (e) {\n                    console.log('Failed to parse details as JSON:', e);\n                }\n                \n                // If JSON parsing failed, try regex patterns\n                if (!requestId && typeof detailsText === 'string') {\n                    // Try matching standard format with HTML bold tags\n                    const boldMatch = detailsText.match(/<b>requestId:<\\/b>\\s*(\\d+)/i);\n                    if (boldMatch && boldMatch[1]) {\n                        requestId = parseInt(boldMatch[1]);\n                    }\n                    \n                    // Try matching without HTML tags\n                    if (!requestId) {\n                        const plainMatch = detailsText.match(/requestId:\\s*(\\d+)/i);\n                        if (plainMatch && plainMatch[1]) {\n                            requestId = parseInt(plainMatch[1]);\n                        }\n                    }\n                    \n                    // Try extracting from any #NUMBER pattern if nothing else worked\n                    if (!requestId) {\n                        const hashMatch = detailsText.match(/request\\s+#(\\d+)/i);\n                        if (hashMatch && hashMatch[1]) {\n                            requestId = parseInt(hashMatch[1]);\n                        }\n                    }\n                }\n                \n                console.log('Final extracted requestId:', requestId);\n                \n                if (requestId) {\n                    const requestIndex = requests.findIndex(r => r.id === requestId);\n                    \n                    if (requestIndex !== -1) {\n                        console.log('Found request at index:', requestIndex);\n                        // Update request status based on workflow status\n                        if (body.status === 'Approved') {\n                            requests[requestIndex].status = 'Approved';\n                            console.log('Updated request status to Approved');\n                        } else if (body.status === 'Rejected') {\n                            requests[requestIndex].status = 'Rejected';\n                            console.log('Updated request status to Rejected');\n                        } else if (body.status === 'Pending') {\n                            requests[requestIndex].status = 'Pending';\n                            console.log('Updated request status to Pending');\n                        }\n                    } else {\n                        console.log('Request not found with ID:', requestId);\n                    }\n                } else {\n                    console.log('Could not extract requestId from details:', detailsText);\n                }\n            }\n            \n            return ok(workflows[workflowIndex]);\n        }\n\n        // Request route functions\n        function getRequests() {\n            // Add employee and user information to requests\n            const requestsWithUserInfo = requests.map(request => {\n                const employee = employees.find(e => e.id === request.employeeId);\n                let userEmail = 'Unknown';\n                let userRole = 'Unknown';\n                \n                if (employee) {\n                    const user = accounts.find(a => a.id === employee.userId);\n                    if (user) {\n                        userEmail = user.email;\n                        userRole = user.role;\n                    }\n                }\n                \n                return {\n                    ...request,\n                    employee: employee ? { \n                        id: employee.id, \n                        employeeId: employee.employeeId \n                    } : null,\n                    userEmail,\n                    userRole,\n                    // Ensure requestItems is properly included\n                    requestItems: request.requestItems || []\n                };\n            });\n            \n            // If user is not an admin, only return their own requests\n            const account = currentAccount();\n            if (account && account.role !== Role.Admin) {\n                const employee = employees.find(e => e.userId === account.id);\n                if (employee) {\n                    return ok(requestsWithUserInfo.filter(r => r.employeeId === employee.id));\n                }\n                return ok([]);\n            }\n            \n            return ok(requestsWithUserInfo);\n        }\n\n        function getRequestById() {\n            const id = parseInt(path.split('/').pop()!);\n            const request = requests.find(r => r.id === id);\n            \n            if (!request) return error('Request not found');\n            \n            // Get employee and user information\n            const employee = employees.find(e => e.id === request.employeeId);\n            let userEmail = 'Unknown';\n            let userRole = 'Unknown';\n            \n            if (employee) {\n                const user = accounts.find(a => a.id === employee.userId);\n                if (user) {\n                    userEmail = user.email;\n                    userRole = user.role;\n                }\n            }\n            \n            // Check if the current user is allowed to view this request\n            const account = currentAccount();\n            if (account && account.role !== Role.Admin) {\n                const userEmployee = employees.find(e => e.userId === account.id);\n                if (!userEmployee || userEmployee.id !== request.employeeId) {\n                    return error('You are not authorized to view this request');\n                }\n            }\n            \n            // Return request with user and employee info\n            return ok({\n                ...request,\n                employee: employee ? { \n                    id: employee.id, \n                    employeeId: employee.employeeId \n                } : null,\n                userEmail,\n                userRole,\n                // Ensure requestItems is properly included\n                requestItems: request.requestItems || []\n            });\n        }\n\n        function getRequestsByEmployeeId() {\n            const employeeIdParam = new URL(url).searchParams.get('employeeId');\n            if (!employeeIdParam) return error('Employee ID is required');\n            \n            const employeeId = parseInt(employeeIdParam);\n            if (isNaN(employeeId)) return error('Invalid employee ID');\n            \n            // Check if employee exists\n            const employee = employees.find(e => e.id === employeeId);\n            if (!employee) return error('Employee not found');\n            \n            // Get user information\n            const user = accounts.find(a => a.id === employee.userId);\n            let userEmail = 'Unknown';\n            let userRole = 'Unknown';\n            \n            if (user) {\n                userEmail = user.email;\n                userRole = user.role;\n            }\n            \n            // Get department information\n            const department = departments.find(d => d.id === employee.departmentId);\n            \n            // Filter requests by employee ID\n            const filteredRequests = requests.filter(r => r.employeeId === employeeId).map(request => ({\n                ...request,\n                Employee: { \n                    ...employee,\n                    User: user ? {\n                        id: user.id,\n                        email: user.email,\n                        role: user.role\n                    } : null,\n                    Department: department ? {\n                        id: department.id,\n                        name: department.name\n                    } : null\n                },\n                userEmail,\n                userRole,\n                // Ensure requestItems is properly included\n                requestItems: request.requestItems || []\n            }));\n            \n            return ok(filteredRequests);\n        }\n\n        function createRequest() {\n            const account = currentAccount();\n            if (!account) return unauthorized();\n            \n            // Use employeeId from body if provided (for admin users)\n            // Otherwise, find employee associated with current user\n            let employeeId;\n            if (body.employeeId && account.role === Role.Admin) {\n                // Admin users can create requests for any employee\n                employeeId = parseInt(body.employeeId);\n                \n                // Verify that the employee exists\n                const employeeExists = employees.some(e => e.id === employeeId);\n                if (!employeeExists) {\n                    return error('Selected employee not found');\n                }\n            } else {\n                // Regular users can only create requests for themselves\n                const employee = employees.find(e => e.userId === account.id);\n                if (!employee) {\n                    return error('No employee record found for current user');\n                }\n                employeeId = employee.id;\n            }\n            \n            // Find employee record for the request\n            const employee = employees.find(e => e.id === employeeId);\n            \n            // Create request with proper structure\n            const request = { \n                id: requests.length + 1,\n                employeeId: employeeId,\n                type: body.type || 'Equipment',\n                status: 'Pending',\n                requestItems: body.requestItems ? body.requestItems.map(item => ({\n                    name: item.name,\n                    quantity: item.quantity || 1\n                })) : []\n            };\n            \n            console.log('Creating new request:', request);\n            requests.push(request);\n            \n            // Create workflow entry for request approval\n            workflows.push({\n                id: workflows.length + 1,\n                employeeId: employeeId,\n                type: 'Request Approval',\n                details: JSON.stringify({\n                    requestId: request.id,\n                    requestType: request.type,\n                    requesterId: employeeId,\n                    message: `Review ${request.type} request #${request.id} from Employee ID ${employee.employeeId}.`\n                }),\n                status: 'Pending'\n            });\n            \n            return ok(request);\n        }\n\n        function updateRequest() {\n            const id = parseInt(path.split('/').pop()!);\n            const reqIndex = requests.findIndex(r => r.id === id);\n            \n            if (reqIndex === -1) return error('Request not found');\n            \n            // Log incoming request update\n            console.log('Updating request:', id, 'with data:', body);\n            \n            // Preserve the employeeId\n            const employeeId = requests[reqIndex].employeeId;\n            const oldStatus = requests[reqIndex].status;\n            \n            // Update the request - prioritize any provided fields or keep the existing values\n            requests[reqIndex] = { \n                id,\n                employeeId,\n                type: body.type || requests[reqIndex].type,\n                status: body.status || requests[reqIndex].status,\n                requestItems: body.requestItems ? body.requestItems.map(item => ({\n                    name: item.name,\n                    quantity: item.quantity || 1\n                })) : (body.items ? body.items.map(item => ({\n                    name: item.name,\n                    quantity: item.quantity || 1\n                })) : requests[reqIndex].requestItems)\n            };\n            \n            console.log('Request updated:', requests[reqIndex]);\n            \n            // Find employee info for the workflow\n            const employee = employees.find(e => e.id === employeeId);\n            if (!employee) return error('Employee not found');\n            \n            // Create workflow entry if status changed\n            if (body.status && body.status !== oldStatus) {\n                workflows.push({\n                    id: workflows.length + 1,\n                    employeeId: employeeId,\n                    type: 'Request Status Updated',\n                    details: JSON.stringify({\n                        requestId: id,\n                        requestType: requests[reqIndex].type,\n                        requesterId: employeeId,\n                        message: `${requests[reqIndex].type} request #${id} from Employee ID ${employee.employeeId} was ${body.status.toLowerCase()}.`\n                    }),\n                    status: 'Completed'\n                });\n            } \n            // Create workflow for request edits if items changed\n            else if (body.items || body.requestItems) {\n                workflows.push({\n                    id: workflows.length + 1,\n                    employeeId: employeeId,\n                    type: 'Request Approval',\n                    details: JSON.stringify({\n                        requestId: id,\n                        requestType: requests[reqIndex].type,\n                        requesterId: employeeId,\n                        message: `Review updated ${requests[reqIndex].type} request #${id} from Employee ID ${employee.employeeId}.`\n                    }),\n                    status: 'Pending'\n                });\n            }\n            \n            return ok(requests[reqIndex]);\n        }\n\n        function getNextEmployeeId() {\n            console.log('Fake backend: Getting next employee ID');\n            \n            // Find the highest employee ID number\n            let maxId = 0;\n            employees.forEach(emp => {\n                if (emp.employeeId && emp.employeeId.startsWith('EMP')) {\n                    const idNum = parseInt(emp.employeeId.substring(3));\n                    if (!isNaN(idNum) && idNum > maxId) {\n                        maxId = idNum;\n                    }\n                }\n            });\n            \n            // Generate the next ID (current max + 1)\n            const nextId = maxId + 1;\n            const nextEmployeeId = 'EMP' + nextId.toString().padStart(3, '0');\n            \n            console.log('Fake backend generated next employee ID:', nextEmployeeId);\n            return ok({ employeeId: nextEmployeeId });\n        }\n\n        // Helper functions\n        function ok(body?) {\n            return of(new HttpResponse({ status: 200, body }));\n        }\n\n        function error(message) {\n            return throwError(() => ({ error: { message } }));\n        }\n\n        function unauthorized() {\n            return throwError(() => ({ status: 401, error: { message: 'Unauthorized' } }));\n        }\n\n        function forbidden() {\n            return throwError(() => ({ status: 403, error: { message: 'Forbidden' } }));\n        }\n\n        function basicDetails(account) {\n            const { id, title, firstName, lastName, email, role, dateCreated, isVerified, status } = account;\n            return { id, title, firstName, lastName, email, role, dateCreated, isVerified, status };\n        }\n\n        function isAuthenticated() {\n            return !!currentAccount();\n        }\n\n        function isAuthorized(role) {\n            const account = currentAccount();\n            if (!account) return false;\n            return account.role === role;\n        }\n\n        function idFromUrl() {\n            const urlParts = path.split('/');\n            return parseInt(urlParts[urlParts.length - 1]);\n        }\n\n        function newAccountId() {\n            return accounts.length ? Math.max(...accounts.map(x => x.id)) + 1 : 1;\n        }\n\n        function currentAccount() {\n            // check if jwt token is in auth header\n            const authHeader = headers.get('Authorization');\n            if (!authHeader || !authHeader.startsWith('Bearer fake-jwt-token')) return;\n\n            // check if token is expired\n            const jwtToken = JSON.parse(atob(authHeader.split('.')[1]));\n            const tokenExpired = Date.now() > (jwtToken.exp * 1000);\n            if (tokenExpired) return;\n\n            const account = accounts.find(x => x.id === jwtToken.id);\n            return account;\n        }\n\n        function generateJwtToken(account) {\n            // create token that expires in 15 minutes\n            const tokenPayload = {\n                exp: Math.round(new Date(Date.now() + 15 * 60 * 1000).getTime() / 1000),\n                id: account.id\n            };\n            return `fake-jwt-token.${btoa(JSON.stringify(tokenPayload))}`;\n        }\n\n        function generateRefreshToken() {\n            const token = new Date().getTime().toString();\n\n            // add token cookie that expires in 7 days\n            const expires = new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toUTCString();\n            document.cookie = `fakeRefreshToken=${token}; expires=${expires}; path=/`;\n            return token;\n        }\n\n        function getRefreshToken() {\n            // get refresh token from cookie\n            return (document.cookie.split(';').find(x => x.includes('fakeRefreshToken')) || '=').split('=')[1];\n        }\n\n        function authorize(requiredRole: Role | null, success: () => Observable<HttpEvent<any>>) {\n            if (!isAuthenticated()) return unauthorized();\n            if (requiredRole && !isAuthorized(requiredRole)) return forbidden();\n            return success();\n        }\n    }\n}\n\nexport const fakeBackendProvider = {\n    provide: HTTP_INTERCEPTORS,\n    useClass: FakeBackendInterceptor,\n    multi: true\n};"]},"metadata":{},"sourceType":"module","externalDependencies":[]}